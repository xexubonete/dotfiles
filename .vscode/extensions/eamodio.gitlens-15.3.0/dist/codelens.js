exports.id=624,exports.ids=[624],exports.modules={4416:(e,n,t)=>{t.d(n,{GitCodeLensProvider:()=>GitCodeLensProvider});var i=t(1398),o=t(2434),s=t(3807),a=t(2124),r=t(7899),l=t(4832),c=t(560),m=t(4026),d=t(3916),u=t(3166),g=t(2471);let GitRecentChangeCodeLens=class GitRecentChangeCodeLens extends i.CodeLens{constructor(e,n,t,i,o,s,a,r,l,c){super(r,c),this.languageId=e,this.symbol=n,this.uri=t,this.dateFormat=i,this.blame=o,this.blameRange=s,this.isFullRange=a,this.desiredCommand=l}getBlame(){return this.blame?.()}};let GitAuthorsCodeLens=class GitAuthorsCodeLens extends i.CodeLens{constructor(e,n,t,i,o,s,a,r){super(a),this.languageId=e,this.symbol=n,this.uri=t,this.blame=i,this.blameRange=o,this.isFullRange=s,this.desiredCommand=r}getBlame(){return this.blame()}};let GitCodeLensProvider=class GitCodeLensProvider{constructor(e){this.container=e}static selector=[...(0,m.Tj)(s.MV,e=>({scheme:e}))];_onDidChangeCodeLenses=new i.EventEmitter;get onDidChangeCodeLenses(){return this._onDidChangeCodeLenses.event}reset(){this._onDidChangeCodeLenses.fire()}async provideCodeLenses(e,n){let t,o;if(e.isDirty&&(0,g.QK)(e.uri))return[];let s=await this.container.documentTracker.getOrAdd(e),a=await s.getStatus();if(!a.blameable)return[];let m=!1;e.isDirty&&!a.dirtyIdle&&(m=!0);let u=l.H.get("codeLens",e),h={...u.scopesByLanguage?.find(n=>n.language?.toLowerCase()===e.languageId)};null==h&&(h={language:e.languageId}),null==h.scopes&&(h.scopes=u.scopes),null==h.symbolScopes&&(h.symbolScopes=u.symbolScopes),h.symbolScopes=null!=h.symbolScopes?h.symbolScopes=h.symbolScopes.map(e=>e.toLowerCase()):[];let b=[],y=s.uri;if(m){if(1!==h.scopes.length||!h.scopes.includes("document")){let n;if([n,o]=await Promise.all([this.container.git.isTracked(y),(0,r.S4)("vscode.executeDocumentSymbolProvider",e.uri)]),!n)return b}}else if(n.isCancellationRequested||(1===h.scopes.length&&h.scopes.includes("document")?t=await this.container.git.getBlame(y,e):[t,o]=await Promise.all([this.container.git.getBlame(y,e),(0,r.S4)("vscode.executeDocumentSymbolProvider",e.uri)]),null==t||t?.lines.length===0))return b;if(n.isCancellationRequested)return b;let C=(0,c.Oo)(()=>e.validateRange(new i.Range(0,0,1e6,1e6))),S=m?{command:void 0,title:this.getDirtyTitle(u)}:void 0;if(void 0!==o)for(let n of(d.Vy.log("GitCodeLensProvider.provideCodeLenses:",`${o.length} symbol(s) found`),o))this.provideCodeLens(b,e,n,h,C,t,y,u,m,S);if((h.scopes.includes("document")||h.symbolScopes.includes("file"))&&!h.symbolScopes.includes("!file")&&null==b.find(e=>0===e.range.start.line&&0===e.range.end.line)){let n;let o=C();if(m||u.recentChange.enabled){m||(n=(0,c.Oo)(()=>this.container.git.getBlameRange(t,y,o)));let s=new i.SymbolInformation(y.fileName,i.SymbolKind.File,"",new i.Location(y.documentUri(),new i.Range(0,0,0,o.start.character)));b.push(new GitRecentChangeCodeLens(e.languageId,s,y,u.dateFormat,n,o,!0,U(s),u.recentChange.command,S))}if(!m&&u.authors.enabled){void 0===n&&(n=(0,c.Oo)(()=>this.container.git.getBlameRange(t,y,o)));let s=new i.SymbolInformation(y.fileName,i.SymbolKind.File,"",new i.Location(y.documentUri(),new i.Range(0,1,0,o.start.character)));b.push(new GitAuthorsCodeLens(e.languageId,s,y,n,o,!0,U(s),u.authors.command))}}return b}getValidateSymbolRange(e,n,t,o){let s,a=!1,r=i.SymbolKind[e.kind].toLowerCase();switch(e.kind){case i.SymbolKind.File:(n.scopes.includes("containers")||n.symbolScopes.includes(r))&&(a=!n.symbolScopes.includes(`!${r}`)),a&&(s=t());break;case i.SymbolKind.Package:(n.scopes.includes("containers")||n.symbolScopes.includes(r))&&(a=!n.symbolScopes.includes(`!${r}`)),a&&0===(s=U(e)).start.line&&0===s.end.line&&(s=t());break;case i.SymbolKind.Class:case i.SymbolKind.Interface:case i.SymbolKind.Module:case i.SymbolKind.Namespace:case i.SymbolKind.Struct:(n.scopes.includes("containers")||n.symbolScopes.includes(r))&&(s=U(e),a=!n.symbolScopes.includes(`!${r}`)&&(o||!s.isSingleLine));break;case i.SymbolKind.Constructor:case i.SymbolKind.Enum:case i.SymbolKind.Function:case i.SymbolKind.Method:case i.SymbolKind.Property:(n.scopes.includes("blocks")||n.symbolScopes.includes(r))&&(s=U(e),a=!n.symbolScopes.includes(`!${r}`)&&(o||!s.isSingleLine));break;case i.SymbolKind.String:(n.symbolScopes.includes(r)||"markdown"===n.language&&n.scopes.includes("containers"))&&(s=U(e),a=!n.symbolScopes.includes(`!${r}`)&&(o||!s.isSingleLine));break;default:n.symbolScopes.includes(r)&&(s=U(e),a=!n.symbolScopes.includes(`!${r}`)&&(o||!s.isSingleLine))}return a?s??U(e):void 0}provideCodeLens(e,n,t,o,s,a,r,l,m,d){try{let u;let g=this.getValidateSymbolRange(t,o,s,l.includeSingleLineSymbols);if(void 0===g)return;let h=n.lineAt(U(t).start);if(e.length&&e[e.length-1].range.start.line===h.lineNumber)return;let b=0;if((m||l.recentChange.enabled)&&(m||(u=(0,c.Oo)(()=>this.container.git.getBlameRange(a,r,g))),e.push(new GitRecentChangeCodeLens(n.languageId,t,r,l.dateFormat,u,g,!1,h.range.with(new i.Position(h.range.start.line,b)),l.recentChange.command,d)),b++),l.authors.enabled){let o=!g.isSingleLine;if(!o&&"csharp"===n.languageId)switch(t.kind){case i.SymbolKind.File:break;case i.SymbolKind.Package:case i.SymbolKind.Module:case i.SymbolKind.Namespace:case i.SymbolKind.Class:case i.SymbolKind.Interface:case i.SymbolKind.Constructor:case i.SymbolKind.Method:case i.SymbolKind.Function:case i.SymbolKind.Enum:o=!0}o&&!m&&(void 0===u&&(u=(0,c.Oo)(()=>this.container.git.getBlameRange(a,r,g))),e.push(new GitAuthorsCodeLens(n.languageId,t,r,u,g,!1,h.range.with(new i.Position(h.range.start.line,b)),l.authors.command)))}}finally{if($(t))for(let i of t.children)this.provideCodeLens(e,n,i,o,s,a,r,l,m,d)}}resolveCodeLens(e,n){return e instanceof GitRecentChangeCodeLens?this.resolveGitRecentChangeCodeLens(e,n):e instanceof GitAuthorsCodeLens?this.resolveGitAuthorsCodeLens(e,n):Promise.reject(void 0)}resolveGitRecentChangeCodeLens(e,n){let t=e.getBlame();if(null==t)return R("Unknown, (Blame failed)",e);let s=(0,m.$1)(t.commits.values());if(null==s)return R("Unknown, (Blame failed)",e);let a=`${s.author.name}, ${null==e.dateFormat?s.formattedDate:s.formatDate(e.dateFormat)}`;if(l.H.get("debug")&&(a+=` [${e.languageId}: ${i.SymbolKind[e.symbol.kind]}(${e.range.start.character}-${e.range.end.character}${e.symbol.containerName?`|${e.symbol.containerName}`:""}), Lines (${e.blameRange.start.line+1}-${e.blameRange.end.line+1}), Commit (${s.shortSha})]`),!1===e.desiredCommand)return R(a,e);switch(e.desiredCommand){case o.Vg.CopyRemoteCommitUrl:return b(a,e,s,!0);case o.Vg.CopyRemoteFileUrl:return y(a,e,s,!0);case o.Vg.DiffWithPrevious:return h(a,e,s);case o.Vg.OpenCommitOnRemote:return b(a,e,s);case o.Vg.OpenFileOnRemote:return y(a,e,s);case o.Vg.RevealCommitInView:return C(a,e,s);case o.Vg.ShowCommitsInView:return S(a,e,t,s);case o.Vg.ShowQuickCommitDetails:return p(a,e,s);case o.Vg.ShowQuickCommitFileDetails:return f(a,e,s);case o.Vg.ShowQuickCurrentBranchHistory:return v(a,e);case o.Vg.ShowQuickFileHistory:return w(a,e);case o.Vg.ToggleFileBlame:return L(a,e);case o.Vg.ToggleFileChanges:return V(a,e,s);case o.Vg.ToggleFileChangesOnly:return V(a,e,s,!0);case o.Vg.ToggleFileHeatmap:return F(a,e);default:return e}}resolveGitAuthorsCodeLens(e,n){let t=e.getBlame();if(null==t)return R("? authors (Blame failed)",e);let s=t.authors.size,a=m.$1(t.authors.values())?.name??"Unknown",r=s>1?` and ${(0,u.td)("one other",s-1,{only:!0,plural:"others"})}`:"",c=`${(0,u.td)("author",s,{zero:"?"})} (${a}${r})`;if(l.H.get("debug")&&(c+=` [${e.languageId}: ${i.SymbolKind[e.symbol.kind]}(${e.range.start.character}-${e.range.end.character}${e.symbol.containerName?`|${e.symbol.containerName}`:""}), Lines (${e.blameRange.start.line+1}-${e.blameRange.end.line+1}), Authors (${(0,m.fj)((0,m.Tj)(t.authors.values(),e=>e.name),", ")})]`),!1===e.desiredCommand)return R(c,e);let d=(0,m.I6)(t.commits.values(),e=>e.author.name===a)??(0,m.$1)(t.commits.values());if(null==d)return R(c,e);switch(e.desiredCommand){case o.Vg.CopyRemoteCommitUrl:return b(c,e,d,!0);case o.Vg.CopyRemoteFileUrl:return y(c,e,d,!0);case o.Vg.DiffWithPrevious:return h(c,e,d);case o.Vg.OpenCommitOnRemote:return b(c,e,d);case o.Vg.OpenFileOnRemote:return y(c,e,d);case o.Vg.RevealCommitInView:return C(c,e,d);case o.Vg.ShowCommitsInView:return S(c,e,t);case o.Vg.ShowQuickCommitDetails:return p(c,e,d);case o.Vg.ShowQuickCommitFileDetails:return f(c,e,d);case o.Vg.ShowQuickCurrentBranchHistory:return v(c,e);case o.Vg.ShowQuickFileHistory:return w(c,e);case o.Vg.ToggleFileBlame:return L(c,e);case o.Vg.ToggleFileChanges:return V(c,e,d);case o.Vg.ToggleFileChangesOnly:return V(c,e,d,!0);case o.Vg.ToggleFileHeatmap:return F(c,e);default:return e}}getDirtyTitle(e){return e.recentChange.enabled&&e.authors.enabled?l.H.get("strings.codeLens.unsavedChanges.recentChangeAndAuthors"):e.recentChange.enabled?l.H.get("strings.codeLens.unsavedChanges.recentChangeOnly"):l.H.get("strings.codeLens.unsavedChanges.authorsOnly")}};function h(e,n,t){return n.command=(0,r.AU)({title:e,command:s.Ts.DiffWithPrevious,arguments:[void 0,{commit:t,uri:n.uri.toFileUri()}]}),n}function b(e,n,t,i=!1){return n.command=(0,r.AU)({title:e,command:s.Ts.OpenOnRemote,arguments:[{resource:{type:a.J.Commit,sha:t.sha},repoPath:t.repoPath,clipboard:i}]}),n}function y(e,n,t,i=!1){return n.command=(0,r.AU)({title:e,command:s.Ts.OpenOnRemote,arguments:[{resource:{type:a.J.Revision,fileName:t.file?.path??"",sha:t.sha},repoPath:t.repoPath,clipboard:i}]}),n}function C(e,n,t){return n.command=(0,r.AU)({title:e,command:t?.isUncommitted?"":o.Vg.RevealCommitInView,arguments:[n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}]}),n}function S(e,n,t,i){let o;return o=void 0===i?[...(0,m.x1)(t.commits.values(),e=>e.isUncommitted?void 0:e.ref)]:[i.ref],n.command=(0,r.AU)({title:e,command:0===o.length?"":s.Ts.ShowCommitsInView,arguments:[{repoPath:t.repoPath,refs:o}]}),n}function p(e,n,t){return n.command=(0,r.AU)({title:e,command:t?.isUncommitted?"":o.Vg.ShowQuickCommitDetails,arguments:[n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}]}),n}function f(e,n,t){return n.command=(0,r.AU)({title:e,command:t?.isUncommitted?"":o.Vg.ShowQuickCommitFileDetails,arguments:[n.uri.toFileUri(),{commit:t,sha:void 0===t?void 0:t.sha}]}),n}function v(e,n){return n.command=(0,r.AU)({title:e,command:o.Vg.ShowQuickCurrentBranchHistory,arguments:[n.uri.toFileUri()]}),n}function w(e,n){return n.command=(0,r.AU)({title:e,command:o.Vg.ShowQuickFileHistory,arguments:[n.uri.toFileUri(),{range:n.isFullRange?void 0:n.blameRange}]}),n}function L(e,n){return n.command=(0,r.AU)({title:e,command:s.Ts.ToggleFileBlame,arguments:[n.uri.toFileUri()]}),n}function V(e,n,t,i){return n.command=(0,r.AU)({title:e,command:s.Ts.ToggleFileChanges,arguments:[n.uri.toFileUri(),{type:"changes",context:{sha:t.sha,only:i,selection:!1}}]}),n}function F(e,n){return n.command=(0,r.AU)({title:e,command:s.Ts.ToggleFileHeatmap,arguments:[n.uri.toFileUri()]}),n}function R(e,n){return n.command={title:e,command:""},n}function U(e){return $(e)?e.range:e.location.range}function $(e){return(0,c.is)(e,"children")}}};