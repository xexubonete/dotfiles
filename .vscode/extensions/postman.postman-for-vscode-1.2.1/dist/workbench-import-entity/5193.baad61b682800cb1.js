"use strict";(self.webpackChunkworkbench_import_entity=self.webpackChunkworkbench_import_entity||[]).push([[5193],{95193:(t,e,r)=>{r.r(e);var o=r(40540),n=r(21730),a=r(60607),s=r(7560),i=r(58560),c=r(16085),l=r(28377),u=r(80605),p=r(35736),d=r(81397),m=r(74962),y=r(35482),g=r(38394),h=r(32054),w=r(59530),f=r.n(w),v=r(32234);var I=r(53186),C=r(98276),b=r(10099),k=r(56880),x=r(26246);const j=async(t,e,r)=>{let o=!1;const n=t?t.map((t=>(t.name===e&&(o=!0),t.name))):[];if(o){const t=x.Modals.getModals(),o=await t.showWarningDialog({uid:`${r}-import-duplicate-warning`,subject:"",message:`${"collection"===r?"A collection":"An environment"} ${e} already exists. What would you like to do?`,options:[{title:"Cancel",isDefaultOnDismiss:!0},{title:"Import as Copy",isPrimary:!0}]});return o&&"Import as Copy"===o.title?(0,C.getDuplicateEntityName)(n,e):"cancel"}return e};var E=r(97201);var S=r(39245),N=r(21466),_=r(13101),A=r(52322);const T=f()(i.Z).withConfig({displayName:"workbench-import-entity__ImportListContainer",componentId:"sc-90lswp-0"})(["margin-top:var(--spacing-l);margin-left:var(--spacing-l);margin-right:var(--spacing-l);flex-direction:column;"]),Z=f()(c.Z).withConfig({displayName:"workbench-import-entity__SearchContainer",componentId:"sc-90lswp-1"})(["margin:var(--spacing-xl);"]),P=f()(l.Z).withConfig({displayName:"workbench-import-entity__StyledTable",componentId:"sc-90lswp-2"})(["padding-left:var(--spacing-xl);padding-right:var(--spacing-xl);"]),O=f()(i.Z).withConfig({displayName:"workbench-import-entity__Footer",componentId:"sc-90lswp-3"})(["margin-right:var(--spacing-xl);margin-top:var(--spacing-xl);"]),W=f()(u.Z).withConfig({displayName:"workbench-import-entity__StyledButton",componentId:"sc-90lswp-4"})([":disabled{background-color:var(--button-primary-background-color) !important;color:var(--button-primary-content-color) !important;opacity:0.5;}"]),D=()=>{var t;const e=(()=>{if(window.NAVIGATION_CONTEXT){const e=JSON.parse(window.NAVIGATION_CONTEXT);try{var t;return JSON.parse(v.Base64.decode(null==e||null==(t=e.options)?void 0:t.importData))}catch(t){return{}}}return{}})(),[r,n]=(0,o.useState)(""),{setTabTitle:a}=(0,S.useTabTitleMeta)();(0,o.useEffect)((()=>{a("Import","import")}),[a]);const[i,c]=(0,o.useState)(null!=(t=e.data)?t:[]),[l,w]=(0,o.useState)((0,s.Z)({},i.map((()=>!0)))),[f,x]=(0,o.useState)(!1),D=(0,b.useActiveWorkspaceId)(),{data:L}=(0,I.useCollectionList)({workspaceId:D}),{data:B}=(0,C.useEnvironmentItems)({workspaceId:D}),q=(()=>{const t=(0,b.useActiveWorkspaceId)(),e=(0,I.useCreateNewCollection)(),r=(0,I.useWorkspacePermissions)(t);return async(o,n)=>{if(!r.userCanCreate)return{status:"error",description:"You do not have permission to import a collection."};const a=await j(n,o.name,"collection");if("cancel"===a)return{status:"error",description:"Import cancelled"};o.name=a;try{return await e.mutateAsync({workspaceId:t,requestBody:o}),k.AnalyticsService.addEventV2({category:"http-collection",action:"create",label:"import",value:1}),{status:"success",description:"Collection imported successfully."}}catch(t){return t.name.includes("TimeoutError")?{status:"error",description:"Import request timed out. Please wait for some time or try again."}:{status:"error",description:"Could not import collection. Please try again."}}}})(),F=(()=>{const t=(0,b.useActiveWorkspaceId)(),e=(0,C.useCreateNewEnvironment)(),{data:r}=(0,E.useDataFetch)((0,C.getEnvironmentSidebarPermissionsQuery)(t));return async(o,n)=>{if(null==r||!r.userCanCreateEnvironment)return{status:"error",description:"You do not have permission to import an environment."};const a=await j(n,o.name,"environment");if("cancel"===a)return{status:"error",description:"Import cancelled"};o.name=a;try{return await e.mutateAsync({workspaceId:t,requestBody:o}),k.AnalyticsService.addEventV2({category:"environment",action:"create",label:"import"}),{status:"success",description:"Environment imported successfully."}}catch(t){return t.name.includes("TimeoutError")?{status:"error",description:"Import request timed out. Please wait for some time or try again."}:{status:"error",description:"Could not import environment. Please try again."}}}})(),M=f?[{id:"status",accessor:"status",cellWidth:"2%",Cell:({value:t})=>{if(t){if(t.isLoading)return(0,A.jsx)(p.Z,{});if(t.error)return(0,A.jsx)(d.Z,{content:t.error,children:(0,A.jsx)(y.Z,{"data-testid":"import-status-icon",color:"content-color-error"})});if(t.success)return(0,A.jsx)(d.Z,{content:"Imported successfully",children:(0,A.jsx)(g.Z,{"data-testid":"import-status-icon",color:"content-color-success"})})}return null}},{Header:"Name",accessor:"name",cellWidth:"40%"},{Header:"Import As",accessor:"format",cellWidth:"40%"},{id:"action",accessor:"status",cellWidth:"5%",Cell:t=>{const e=t.row.original;return e.status&&e.status.error?(0,A.jsx)(u.Z,{onClick:()=>V(e),type:"plain",text:"Retry"}):null}}]:[{Header:"Name",accessor:"name"},{Header:"Import As",accessor:"format"}],R=(t,e)=>{const r=[...i],o=r.find((e=>e.path===t));o&&(o.status=e),c(r)},V=async t=>{let e={isLoading:!0};R(t.path,e);try{const r=await(async t=>{{const e=await N.VSCodeCommunicationsService.postMessageToExtensionAsPromise({type:"IMPORT_FILE",payload:{fileDetails:t,userId:(0,_.getUserId)()}});if(e.err)throw new Error(e.val.message);return e.val}})(t),o="postman_collection"===r.type?await q(r.data,null!=L?L:[]):await F(r.data,null!=B?B:[]);"error"===o.status&&(e={isLoading:!1,error:o.description}),"success"===o.status&&(e={isLoading:!1,success:!0})}catch(t){e={isLoading:!1,error:t.message}}finally{R(t.path,e)}};return(0,o.useEffect)((()=>{if(f)for(const t of i)V(t)}),[f]),(0,A.jsxs)(T,{"data-testid":"import-list-container",children:[(0,A.jsx)(m.Z,{type:"h3",text:`Import Elements (${i.length})`}),(0,A.jsx)(Z,{type:"search",value:r,onClear:()=>n(""),onChange:t=>{n(t.target.value)},placeholder:"Search for a file",width:"40%",prefix:(0,A.jsx)(h.Z,{})}),(0,A.jsx)(P,{data:i,columns:M,globalFilter:{filter:r},rowSelected:f?{}:{onSelect:t=>w(t),initialSelectionState:l}}),(0,A.jsx)(O,{justifyContent:"flex-end",children:f?(0,A.jsx)(A.Fragment,{}):(0,A.jsx)(W,{onClick:async()=>{const t=[];for(const e of Object.keys(l))t.push(i[Number(e)]);c(t),x(!0)},type:"primary",text:"Import","data-testid":"import-btn",isDisabled:0===Object.keys(l).length})})]})};var L=r(21180);const B=[{path:"/workspace/:workspaceId/import/:importId",element:(0,A.jsx)(D,{}),errorElement:(0,A.jsx)(L.RouteErrorBoundary,{appId:"workbench-import-entity",errorElementId:"workbench-import-entity-route"})}],{router:q}=(0,S.createPlatformRouter)(B);function F(){return(0,A.jsx)(a.RouterProvider,{router:q})}var M=r(28422);const R=document.querySelector("#workbench-import-entity_root");n.render((0,A.jsx)(M.PostmanBootstrap,{appId:"workbench-import-entity",errorElementId:"global-error-boundary",children:(0,A.jsx)(F,{})}),R)}}]);
//# sourceMappingURL=5193.baad61b682800cb1.js.map