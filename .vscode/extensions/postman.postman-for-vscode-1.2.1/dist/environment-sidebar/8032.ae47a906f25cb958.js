"use strict";(self.webpackChunkenvironment_sidebar=self.webpackChunkenvironment_sidebar||[]).push([[8032],{18032:(e,t,n)=>{n.d(t,{Z:()=>je});var i=n(40540),s=n.n(i),a=n(59530),r=n.n(a),o=n(80605),l=n(82420),d=n(25869),c=n(17647),m=n(64691),p=n(48263),h=n(59824),u=n(17282),v=n(29225),g=n(26246),y=n(19578),x=n(39245),b=n(56880),f=n(35736),_=n(7246);const j=r().div.withConfig({displayName:"styled__ActionMenuContainer",componentId:"sc-eemidz-0"})(["width:32px;"]),C=r().li.withConfig({displayName:"styled__ItemContainer",componentId:"sc-eemidz-1"})(["display:flex;flex-direction:row;justify-content:space-between;height:28px;align-items:center;font-size:var(--text-size-m,12px);overflow:hidden;box-sizing:border-box;color:var(--content-color-primary,var(--grey-90));gap:var(--spacing-s);background-color:",";&:hover{background-color:var(--highlight-background-color-secondary);","{opacity:1;}}","{opacity:",";}"],(e=>e.isActive?"var(--highlight-background-color-secondary)":e.$isOpen?"var(--highlight-background-color-tertiary)":""),j,j,(e=>e.isActive?1:0)),w=r().div.withConfig({displayName:"styled__ItemLinkContainer",componentId:"sc-eemidz-2"})(["overflow:hidden;flex-grow:1;height:100%;"]),N=r()(x.Link).withConfig({displayName:"styled__ItemLink",componentId:"sc-eemidz-3"})(["display:flex;align-items:center;height:100%;width:100%;color:var(--content-color-primary);&:hover{color:var(--content-color-primary);}"]),k=r().div.withConfig({displayName:"styled__DisabledLinkContainer",componentId:"sc-eemidz-4"})(["display:flex;align-items:center;justify-content:space-between;gap:var(--spacing-s);height:100%;width:100%;color:var(--content-color-primary);cursor:not-allowed;&:hover{color:var(--content-color-primary);}"]),I=r().span.withConfig({displayName:"styled__ItemName",componentId:"sc-eemidz-5"})(["box-sizing:border-box;display:inline-block;text-overflow:ellipsis;overflow:hidden;white-space:nowrap;margin-left:var(--spacing-l);flex:2;max-width:fit-content;"]),E=r().div.withConfig({displayName:"styled__ItemActionZone",componentId:"sc-eemidz-6"})(["display:flex;align-items:center;gap:var(--spacing-xs);"]),D=r()(f.Z).withConfig({displayName:"styled__LoadingSpinner",componentId:"sc-eemidz-7"})(["padding-right:var(--spacing-s);"]),L=r()(_.InlineEditor).withConfig({displayName:"styled__StyledInlineEditor",componentId:"sc-eemidz-8"})(["margin-left:var(--spacing-l);box-sizing:border-box;width:100%;"]);var Z=n(10099),z=n(98276),O=n(97201);const S={userCanCreateEnvironment:!0,userCanUpdateGlobals:!0},R=e=>{const{data:t,error:n}=(0,O.useDataFetch)((0,z.getEnvironmentSidebarPermissionsQuery)(e));return n?Object.assign({isLoading:!1},S):t?Object.assign({isLoading:!1},t):Object.assign({isLoading:!0},S)};var A=n(52322),M=function(e){return e.delete="delete",e.duplicate="duplicate",e.rename="rename",e}(M||{});const $=e=>e?"You don't have permission to take this action.":"",U=({environmentName:e,environmentId:t,permissions:n,isMenuOpen:i,setIsMenuOpen:s,setIsRenameMode:a})=>{const r=(0,x.useNavigate)(),l=(0,Z.useActiveWorkspaceId)(),d=(0,z.useEnvironmentDelete)(),c=(0,z.useEnvironmentDuplicate)(),{userCanCreateEnvironment:f}=R(l),_=g.Modals.getModals(),C=(0,y.getTabManager)(),w=async n=>{if(n===M.delete){const n=await _.showWarningDialog({uid:"delete-environment-confirmation",subject:`Delete "${e}"?`,message:"Deleting this environment might cause any monitors, scheduled runs or mock servers using it to stop functioning properly. Are you sure you want to continue?",options:[{title:"Cancel",isDefaultOnDismiss:!0},{title:"Delete",isPrimary:!0}]});if(n&&"Delete"===n.title)return C.closeTabByRoute(`/workspace/${l}/environment/${t}`),b.AnalyticsService.addEventV2({category:"environment",action:"delete",label:"sidebar"}),d.mutate({environmentId:t,workspaceId:l})}return n===M.duplicate?c.mutate({environmentId:t,workspaceId:l},{onSuccess:({data:e})=>{r(`/workspace/${l}/environment/${e.owner}-${e.id}`,{},{customNavEvent:x.OPEN_EXTENSION_URL})}}):n===M.rename?a(!0):void 0};return(0,A.jsx)(j,{children:(0,A.jsxs)(m.Z,{isOpen:i,closeMenu:()=>s(!1),children:[(0,A.jsx)(p.Z,{onClick:()=>{s((e=>!e))},children:(0,A.jsx)(o.Z,{"data-testid":"view-more-actions",icon:(0,A.jsx)(v.Z,{}),type:"tertiary",className:"action-menu-icon",tooltip:"View more actions"})}),(0,A.jsxs)(h.Z,{placement:"bottom-end",children:[(0,A.jsx)(u.Z,{isDisabled:!n.userCanUpdate,tooltip:$(!n.userCanUpdate),onClick:()=>w(M.rename),children:"Rename"}),(0,A.jsx)(u.Z,{isDisabled:!f,tooltip:$(!f),onClick:()=>w(M.duplicate),children:"Duplicate"}),(0,A.jsx)(u.Z,{type:n.userCanDelete?"destructive":"default ",isDisabled:!n.userCanDelete,tooltip:$(!n.userCanDelete),onClick:()=>w(M.delete),children:"Delete"})]})]})})};var P=n(60398);const G=()=>{const e=(0,x.useNavigate)(),t=(0,Z.useActiveWorkspaceId)(),n=(0,z.useCreateNewEnvironment)(),{userCanCreateEnvironment:s}=R(t);return{userCanCreateEnvironment:s,isCreating:n.isLoading,handler:(0,i.useCallback)((()=>{n.mutate({workspaceId:t,requestBody:{id:(0,P.v4)(),name:"New Environment",values:[]}},{onSuccess:({data:n})=>{b.AnalyticsService.addEventV2({category:"environment",action:"create",label:"sidebar"}),e(`/workspace/${t}/environment/${n.owner}-${n.id}`,{state:JSON.stringify({additionalContext:{rename:!0}})},{customNavEvent:x.OPEN_EXTENSION_URL})}})}),[t,n,e])}},W=r().div.withConfig({displayName:"environment-sidebar-header__HeaderContainer",componentId:"sc-uidhho-0"})(["display:flex;box-sizing:border-box;align-items:center;margin:var(--spacing-s);"]),B=r()(o.Z).withConfig({displayName:"environment-sidebar-header__CreateNewButton",componentId:"sc-uidhho-1"})(["margin-right:var(--spacing-s);width:var(--size-s);padding:0;height:24px;"]),Q=({isCreateNewButtonDisabled:e,searchQuery:t,onSearchQueryChange:n})=>{const{userCanCreateEnvironment:i,isCreating:s,handler:a}=G(),r=e||s||!i;return(0,A.jsxs)(W,{"data-testid":"create-new-button-container",children:[(0,A.jsx)(B,{icon:(0,A.jsx)(d.Z,{}),type:"tertiary",isDisabled:r,tooltip:$(!i),onClick:a}),(0,A.jsx)(l.Z,{onChange:e=>n(e.target.value),value:t,placeholder:"Filter",prefix:(0,A.jsx)(c.Z,{}),onClear:()=>n(""),"data-testid":"environment-top-bar-search-input","aria-label":"filter-environments"})]})};var T=n(81397),F=n(58560),H=n(83729);const V=({isHidden:e})=>e?null:(0,A.jsx)(F.Z,{padding:{paddingLeft:"spacing-s"},children:(0,A.jsx)(H.Z,{"data-testid":"lock-icon",title:"Read only",color:"content-color-tertiary"})}),X=r()("div").withConfig({displayName:"sidebar-container__Container",componentId:"sc-1y5a9l0-0"})(["display:flex;flex-direction:column;height:100%;"]),q=r()("div").withConfig({displayName:"sidebar-container__GlobalLinkWrapper",componentId:"sc-1y5a9l0-1"})(["height:28px;flex-shrink:0;background-color:",";&:hover{background-color:var(--highlight-background-color-secondary);}"],(e=>e.$isOpen?"var(--highlight-background-color-tertiary)":"")),Y=r()("hr").withConfig({displayName:"sidebar-container__GlobalsSeparator",componentId:"sc-1y5a9l0-2"})(["border:none;border-top:1px solid var(--border-color-default);width:calc(100% - var(--spacing-xl));"]),J=({children:e,isCreateNewButtonDisabled:t})=>{const[n,a]=(0,i.useState)(""),r=(0,Z.useActiveWorkspaceId)(),o=R(r),l=(0,z.useCurrentEnvironmentId)();return(0,A.jsxs)(X,{children:[(0,A.jsx)(Q,{isCreateNewButtonDisabled:t,searchQuery:n,onSearchQueryChange:a}),(0,A.jsx)(q,{$isOpen:"globals"===l,children:(0,A.jsx)(w,{children:(0,A.jsxs)(N,{to:`/workspace/${r}/globals`,customNavEvent:x.OPEN_EXTENSION_URL,"customNavEvent-updateURL":!0,children:[(0,A.jsx)(T.Z,{content:"Globals",openDelay:500,placement:"bottom",children:(0,A.jsx)(I,{children:"Globals"})}),(0,A.jsx)(V,{isHidden:o.userCanUpdateGlobals})]})})}),(0,A.jsx)(Y,{}),s().Children.map(e,(e=>s().isValidElement(e)?s().cloneElement(e,{searchQuery:n}):e))]})};var K=n(70875);const ee=({numLoadingTiles:e=10})=>{const t=Array(e).fill(0);return(0,A.jsx)("div",{className:"sidebar-loading-state_sidebar-loading-state__XG889","data-testid":"sidebar-loading-state",children:t.map(((e,t)=>(0,A.jsx)("div",{className:"sidebar-loading-state_sidebar-loading-state--item__Z1vOR",children:(0,A.jsx)("div",{className:"sidebar-loading-state_sidebar-loading-state__info__qDG37"})},t)))})};var te=n(74962),ne=n(9460);const ie=e=>{const t=e.illustration||null;return(0,A.jsxs)("div",{className:"sidebar-empty-state_sidebar-empty-state__zGbOy",children:[(0,A.jsx)("div",{className:"sidebar-empty-state_sidebar-empty-state__illustration__sxdhr",children:t}),(0,A.jsxs)("div",{className:"sidebar-empty-state_sidebar-empty-state__head-and-body__z9GWI",children:[(0,A.jsx)("div",{className:"sidebar-empty-state_sidebar-empty-state__title__C6Q5t",children:(0,A.jsx)(te.Z,{type:"h4",color:"content-color-secondary",text:e.title})}),(0,A.jsx)("div",{className:"sidebar-empty-state_sidebar-empty-state__description__771s1",children:(0,A.jsx)(ne.ZP,{type:"body-medium",color:"content-color-secondary",children:e.message})})]}),e.action&&(0,A.jsx)("div",{className:"sidebar-empty-state_sidebar-empty-state__cta__AhqHg",children:(0,A.jsx)(o.Z,{type:"primary",size:"medium",text:e.action.label,isDisabled:!e.hasPermissions,tooltip:e.action.tooltip,onClick:()=>{e.action&&e.action.handler&&e.action.handler()}})})]})};var se=n(31660),ae=n.n(se),re=n(494),oe=n(37691);const le=r().div.withConfig({displayName:"fork-label__ForkLabelWrapper",componentId:"sc-5amwpt-0"})(["display:flex;align-items:center;overflow:hidden;margin-left:var(--spacing-s);flex:1;max-width:fit-content;"]),de=r().p.withConfig({displayName:"fork-label__LabelContainer",componentId:"sc-5amwpt-1"})(["display:inline-block;white-space:nowrap;overflow:hidden;margin-left:var(--spacing-xs);font-size:var(--text-size-s);font-weight:var(--text-weight-regular);text-overflow:ellipsis;color:var(--content-color-tertiary);"]),ce=({label:e})=>e?(0,A.jsxs)(le,{children:[(0,A.jsx)(oe.Z,{color:"content-color-tertiary",size:"small","data-testid":"fork-icon"}),(0,A.jsx)(T.Z,{content:e,openDelay:500,placement:"bottom",children:(0,A.jsx)(de,{children:e})})]}):null,me=({item:e})=>{var t;const n=(0,z.useCurrentEnvironmentId)(),s=(0,Z.useActiveWorkspaceId)(),[a,r]=(0,i.useState)(!1),[o,l]=(0,i.useState)(!1),d=(0,z.useUpdateEnvironmentName)();return(0,z.isEnvironmentItemLoading)(e)?(0,A.jsx)(C,{role:"listitem",isActive:!1,children:(0,A.jsxs)(k,{children:[(0,A.jsx)(I,{children:e.name}),(0,A.jsx)(D,{size:"small","data-testid":"env-item-loading"})]})}):(0,A.jsxs)(C,{role:"listitem",isActive:a,$isOpen:n===e.id,onContextMenu:e=>{e.stopPropagation(),r(!0)},children:[(0,A.jsx)(w,{children:(0,A.jsxs)(N,{to:`/workspace/${s}/environment/${e.id}`,customNavEvent:x.OPEN_EXTENSION_URL,"customNavEvent-updateURL":!0,children:[(0,A.jsx)(T.Z,{content:e.name,openDelay:500,placement:"bottom",children:o?(0,A.jsx)(L,{isEditMode:o,setIsEditMode:l,value:e.name,onSubmit:t=>d.mutate({workspaceId:s,environmentId:e.id,name:t}),onCancel:()=>null}):(0,A.jsx)(I,{children:e.name})}),(0,A.jsx)(ce,{label:null==(t=e.attributes.fork)?void 0:t.forkLabel}),(0,A.jsx)(V,{isHidden:e.attributes.permissions.userCanUpdate})]})}),(0,A.jsx)(E,{children:(0,A.jsx)(U,{permissions:e.attributes.permissions,environmentName:e.name,environmentId:e.id,isMenuOpen:a,setIsMenuOpen:r,setIsRenameMode:l})})]})},pe=({index:e,data:t,style:n})=>{const{items:i}=t,s=i[e];return s?(0,A.jsx)("div",{style:n,children:(0,A.jsx)(me,{item:s},s.id)}):null},he=r().div.withConfig({displayName:"styled__SidebarListContainer",componentId:"sc-1dfoij9-0"})(["height:100%;"]),ue=(e,{items:t})=>{const n=t[e];return n?n.id:"0"},ve=({items:e})=>(0,A.jsx)(he,{role:"list",children:(0,A.jsx)(ae(),{children:({height:t,width:n})=>(0,A.jsx)(re.VariableSizeList,{itemKey:ue,height:t,width:n,overscanCount:10,itemSize:()=>28,itemData:{items:e},itemCount:e.length,children:pe})})}),ge=r().div.withConfig({displayName:"refetch-item__MetaContainer",componentId:"sc-l9flvp-0"})(["height:100%;width:100%;display:flex;align-items:center;justify-content:center;font-size:var(--text-size-m);line-height:var(--line-height-m);padding:var(--spacing-xs) 0;color:var(--content-color-tertiary);"]),ye=r().button.withConfig({displayName:"refetch-item__RetryButton",componentId:"sc-l9flvp-1"})(["all:unset;color:var(--content-color-brand);cursor:pointer;display:inline-block;margin-left:var(--spacing-xs);"]),xe=r().div.withConfig({displayName:"refetch-item__SpinnerWrapper",componentId:"sc-l9flvp-2"})(["height:100%;display:flex;align-items:center;justify-content:center;"]);function be({isRefetching:e,onRetry:t}){return e?(0,A.jsx)(ge,{children:(0,A.jsx)(xe,{children:(0,A.jsx)(f.Z,{size:"small"})})}):(0,A.jsx)(ge,{children:(0,A.jsxs)(ne.ZP,{type:"para",children:["Unable to load items.",t&&(0,A.jsx)(ye,{onClick:t,children:"Retry"})]})})}const fe=({isError:e,isLoading:t,isRefetching:n,refetch:i,items:s,searchQuery:a=""})=>{const{userCanCreateEnvironment:r,isCreating:o,handler:l}=G();if(e)return(0,A.jsx)(be,{isRefetching:n,onRetry:i});if(t)return(0,A.jsx)(ee,{});if(!Array.isArray(s))return(0,A.jsx)(be,{isRefetching:n,onRetry:i});if(0===s.length)return(0,A.jsx)(ie,{illustration:(0,A.jsx)(K.Z,{}),title:"You don’t have any environments.",message:"An environment is a set of variables that allows you to switch the context of your requests.",hasPermissions:r&&!o,action:{label:"Create Environment",handler:l,tooltip:r?"":"You do not have permissions to create an environment in this workspace"}});const d=a?s.filter((e=>{var t;return null==e||null==(t=e.name)?void 0:t.toLowerCase().includes(a.toLowerCase())})):s;return a&&0===d.length?(0,A.jsx)(ie,{illustration:(0,A.jsx)(K.Z,{}),title:`No results found for "${a}"`,message:"Please try again using different keywords, and don’t forget to check for typos.",hasPermissions:!1}):(0,A.jsx)(ve,{items:d})},_e=()=>{const e=(0,Z.useActiveWorkspaceId)(),t=R(e),{data:n,isError:i,isRefetching:s,refetch:a}=(0,z.useEnvironmentItems)({workspaceId:e});(0,z.useEnvironmentListSubscription)(e);const r=!n||t.isLoading,o=Array.isArray(n),l=i||r||!o;return(0,A.jsxs)(J,{isCreateNewButtonDisabled:l,children:[(0,A.jsx)(fe,{isLoading:r,isError:i,isRefetching:s,refetch:a,items:n}),(0,A.jsx)(g.Modals.Ui.ModalDialog,{uid:"delete-environment-confirmation"})]})},je=()=>(0,z.useEnvironmentFeatureFlag)()?(0,A.jsx)(_e,{}):null}}]);
//# sourceMappingURL=8032.ae47a906f25cb958.js.map