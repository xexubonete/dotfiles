"use strict";(self.webpackChunkhttp_workbench=self.webpackChunkhttp_workbench||[]).push([[2557],{32557:(e,n,t)=>{t.r(n),t.d(n,{ActiveEnvironmentSelector:()=>zn,ENVIRONMENTS_SIDEBAR_PERMISSIONS_QUERY_KEY_PREFIX:()=>E,ENVIRONMENT_BROADCAST_EVENT_ACTIONS:()=>N,ENVIRONMENT_ITEM_BROADCAST_EVENT_ACTIONS:()=>P,ENVIRONMENT_ITEM_QUERY_KEY_PREFIX:()=>b,ENVIRONMENT_LIST_QUERY_KEY_PREFIX:()=>p,ENVIRONMENT_SELECTOR_PERMISSIONS_QUERY_KEY_PREFIX:()=>f,ENVIRONMENT_WORKBENCH_PERMISSIONS_QUERY_KEY_PREFIX:()=>w,GLOBALS_BROADCAST_EVENT_ACTIONS:()=>O,GLOBALS_ITEM_QUERY_KEY_PREFIX:()=>h,GLOBALS_WORKBENCH_PERMISSIONS_QUERY_KEY_PREFIX:()=>g,SECRET:()=>de,VariablesContextProvider:()=>W,VariablesContextStore:()=>l,WORKSPACE_BROADCAST_EVENT_ACTIONS:()=>D,WORKSPACE_QUERY_KEY_PREFIX:()=>y,environmentItemsQuery:()=>M,environmentVariablesHandler:()=>mt,environmentsSubscriptionHandler:()=>Et,getActiveEnvironment:()=>F,getActiveEnvironmentSession:()=>bt,getActiveGlobalsSession:()=>yt,getDuplicateEntityName:()=>oe,getDynamicVariableQuery:()=>Gn,getEnvironmentItemQuery:()=>wn,getEnvironmentItemQuerySafe:()=>gn,getEnvironmentSelectorPermissionsQuery:()=>jn,getEnvironmentSidebarPermissionsQuery:()=>_n,getEnvironmentWorkbenchPermissionsQuery:()=>Pn,getGlobalsItemQuery:()=>fn,getGlobalsWorkbenchPermissionsQuery:()=>Fn,globalVariablesHandler:()=>pt,isEnvironmentItemLoading:()=>Qn,resolveVariablesInObject:()=>ut,setActiveEnvironment:()=>U,unZipVariables:()=>ue,updateEnvironment:()=>dt,updateEnvironmentCacheAndSession:()=>T,updateEnvironmentMutation:()=>nt,updateEnvironmentNameMutation:()=>ct,updateEnvironmentWithSessionMutation:()=>tt,updateGlobals:()=>vt,updateGlobalsCacheAndSession:()=>x,updateGlobalsMutation:()=>st,updateGlobalsWithSessionMutation:()=>it,useActiveAndDynamicVariables:()=>Ee,useActiveEnvironment:()=>B,useActiveVariables:()=>he,useCreateNewEnvironment:()=>J,useCurrentEnvironmentId:()=>Ie,useEnvironmentDelete:()=>z,useEnvironmentDuplicate:()=>se,useEnvironmentFeatureFlag:()=>X,useEnvironmentItems:()=>G,useEnvironmentListSubscription:()=>te,useEnvironmentSubscription:()=>ie,useSetAsActiveEnvironment:()=>ae,useUpdateEnvironmentName:()=>fe,useUpdateEnvironmentRoles:()=>ke,zipVariables:()=>ce});var a=t(78476),r=t(29875);const o=new r.KVStorage("last-used-active-environment"),s=async e=>await o.get(e)||null,i={queryFn:()=>Promise.reject(),enabled:!1,useErrorBoundary:!1};class l{constructor({collectionFetchOptions:e},n){this.activeEnvironment=null,this.collectionFetchOptions=void 0,this.meta=void 0,this.useActiveEnvironmentFromContext=void 0,this.loadLastUsedActiveEnvironment=()=>{s(this.meta.workspaceId).then((e=>{(0,a.runInAction)((()=>{this.activeEnvironment=e}))})).catch((()=>{}))},this.setActiveEnvironment=e=>{this.activeEnvironment=e,(async(e,n)=>(await o.set(e,n),n))(this.meta.workspaceId,e).catch((()=>{}))},this.meta=n,this.useActiveEnvironmentFromContext=!e,this.collectionFetchOptions=e||i,(0,a.makeObservable)(this,{activeEnvironment:a.observable,setActiveEnvironment:a.action}),this.useActiveEnvironmentFromContext&&this.loadLastUsedActiveEnvironment()}}var c=t(40540),u=t.n(c),d=t(97201),v=t(10099),m=t(45860);const p="environments",b="environment",y="workspace",h="globals",E="environment-sidebar-permissions",w="environment-workbench-permissions",g="globals-workbench-permissions",f="environment-selector-permissions",C=new class{constructor(){var e=this;this.observer=null,this.environmentId="",this.abortController=null,this.asyncObserver=null,this.changeEnvironment=e=>{this.environmentId&&this.unsubscribe(),this.environmentId=e},this.subscribe=async function({environmentId:n=e.environmentId,subscriptionHandler:t}){if(""===n)return;if(e.environmentId!==n&&e.changeEnvironment(n),e.observer||e.asyncObserver)return;const{asyncObserver:a,abortController:r}=(e=>{const n=new AbortController;return{asyncObserver:m.postmanWebsocketGateway.subscribe({signal:n.signal,subscribeRequest:{method:"post",service:"sync",url:`/environment/${e}/subscribe`,data:{}},subscriptionEvents:["update","update_roles"],responseFilter:e=>{var n;return null==e||null==(n=e.body)?void 0:n.model_id},broadcastFilter:e=>null==e?void 0:e.model_id,unsubscribeRequest:{method:"delete",service:"sync",url:`/environment/${e}/subscribe`,data:{}}}),abortController:n}})(n);e.abortController=r,e.asyncObserver=a,e.observer=await a,e.abortController=null,(0,d.invalidateCache)([b,n]),e.observer.subscribe({next:e=>{t(e,{environmentId:n})},complete:()=>{e.unsubscribe()},error:async function(a){e.cleanup(),await e.subscribe({subscriptionHandler:t,environmentId:n})}})},this.unsubscribe=()=>{var e,n;null==(e=this.abortController)||e.abort(),null==(n=this.observer)||n.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}};var I=t(7560),k=t(85692),S=t(26663),A=t.n(S);const _=e=>(0,I.Z)({},e,{id:`${e.owner}-${e.id}`}),T=async(e,n)=>{const t=_(n);(0,d.updateCache)({key:[b,e],updater:e=>e?(0,I.Z)({},e,t):e}),await(0,k.updateDependentSession)({model:"environment",modelId:t.id},t)},x=async(e,n)=>{(0,d.updateCache)({key:[h,e],updater:e=>e?(0,I.Z)({},e,n):e}),await(0,k.updateDependentSession)({model:"globals",modelId:n.id},n)};var R=t(14350);let O=function(e){return e.UPDATE="update",e}({}),N=function(e){return e.DELETE="delete",e.CREATE="create",e.UPDATE="update",e}({}),P=function(e){return e.UPDATE="update",e.UPDATE_ROLES="update_roles",e}({}),D=function(e){return e.UPDATE="update",e.UPDATE_ROLES="update_roles",e}({});const L=(e,{environmentId:n})=>{var t;const a=null==e||null==(t=e.meta)?void 0:t.action,r=null==e?void 0:e.data;if(a&&r)switch(a){case P.UPDATE:T(n,r);break;case P.UPDATE_ROLES:(0,d.invalidateCache)([R.ACCESS_CONTROL_QUERY_KEY_PREFIX,R.ALL_ROLES,"environment",n])}},V=new r.KVStorage("active-environment"),F=async e=>V.get($(e)),U=async(e,n)=>{return V.set($(e),(t=n,JSON.parse(JSON.stringify(t))));var t},$=({model:e,modelId:n})=>[e,n].join("/"),j=()=>V,M=e=>({queryKey:[p,e],queryFn:({signal:n})=>(async({signal:e,workspaceId:n})=>{const t=await m.postmanGateway.post({url:`${A().HTTPS_GATEWAY_PRIVATE_URL}/list/environment`,headers:{"Content-type":"text/plain"},signal:e,query:{workspace:n}});if(!Array.isArray(null==t?void 0:t.data))throw new TypeError("Received invalid response from server");return t.data})({signal:n,workspaceId:e}),select:e=>(Array.isArray(e)&&e.sort(((e,n)=>e.name.localeCompare(n.name))),e),useErrorBoundary:!1}),G=({workspaceId:e})=>(0,d.useDataFetch)(M(e)),B=()=>{const e=(0,v.useActiveWorkspaceId)(),n=(0,c.useContext)(K);if(!n)throw new Error("useActiveEnvironment must be used within a VariablesContextProvider");const[t,o]=(0,c.useState)(n.activeEnvironment);(0,c.useEffect)((()=>{if(n.useActiveEnvironmentFromContext)return(0,a.reaction)((()=>n.activeEnvironment),o)}),[n]);const{data:s}=(0,d.useDataFetch)(n.collectionFetchOptions),i=s?$({model:"collection",modelId:s.id}):"",{value:l}=(0,r.useKVStorage)(j(),i),u=n.useActiveEnvironmentFromContext?t:l,{data:m,isLoading:p,isError:b}=G({workspaceId:e}),y=(null==u?void 0:u.id)&&(null==m?void 0:m.some((({id:e})=>e===u.id)));return y?{data:u,isLoading:p,isError:b}:{data:null,isLoading:p,isError:b}};var Q=t(52322);const K=(0,c.createContext)(void 0),q=()=>{const{data:e}=B();return(0,c.useEffect)((()=>{if(e)return C.subscribe({environmentId:e.id,subscriptionHandler:L}),()=>C.unsubscribe()}),[e]),null},W=({store:e,children:n})=>((e=>{const n=(0,v.useActiveWorkspaceId)(),{data:t}=(0,d.useDataFetch)(e.collectionFetchOptions);(0,c.useEffect)((()=>{null!=t&&t.id&&(async e=>V.has($(e)))({model:"collection",modelId:t.id}).then((e=>{if(!e)return s(n).then((e=>U({model:"collection",modelId:t.id},e)))}))}),[t])})(e),(0,Q.jsxs)(K.Provider,{value:e,children:[(0,Q.jsx)(q,{}),n]}));var Y=t(60398),Z=t(39245),H=t(56880);const X=()=>!0,z=()=>{const e=(0,d.useCacheClient)();return(0,d.useMutation)({mutationFn:({environmentId:e})=>(async e=>{const n=await m.postmanGateway.delete({url:`${A().HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}`});return await(0,k.deleteDependentSession)({model:"environment",modelId:e}),n})(e),onMutate:async({workspaceId:n,environmentId:t})=>{const a=[p,n];await e.cancelQueries({queryKey:a}),(0,d.updateCache)({key:a,updater:e=>e?e.filter((({id:e})=>e!==t)):e})},onSettled:(e,n,{workspaceId:t})=>{(0,d.invalidateCache)([p,t])}})},J=()=>{const e=(0,d.useCacheClient)();return(0,d.useMutation)({mutationFn:({workspaceId:e,requestBody:n})=>(async(e,n)=>await m.postmanGateway.post({url:`${A().HTTPS_GATEWAY_PRIVATE_URL}/environment/import`,body:JSON.stringify(n),query:{workspace:e}}))(e,n),onMutate:async({workspaceId:n,requestBody:t})=>{const a=[p,n];await e.cancelQueries({queryKey:a}),e.setQueryData(a,(e=>[...null!=e?e:[],{id:window.USER_ID+"-"+t.id,name:t.name,isLoading:!0}]))},onSettled:(e,n,{workspaceId:t})=>{(0,d.invalidateCache)([p,t])},useErrorBoundary:!1})},ee=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.abortController=null,this.asyncObserver=null,this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.subscribe=async function({workspaceId:n=e.workspaceId,subscriptionHandler:t}){if(""===n)return;if(e.workspaceId!==n&&e.changeWorkspace(n),e.observer||e.asyncObserver)return;const{asyncObserver:a,abortController:r}=(e=>{const n=new AbortController;return{asyncObserver:m.postmanWebsocketGateway.subscribe({signal:n.signal,subscribeRequest:{method:"post",url:`/list/environment?workspace=${e}&subscribe=true`,service:"sync"},subscriptionEvents:["broadcast"],responseFilter:e=>{var n;return null==e||null==(n=e.body)||null==(n=n.subscription)?void 0:n.id},broadcastFilter:e=>{var n;return null==e||null==(n=e.data)||null==(n=n.subscription)?void 0:n.id},unsubscribeRequest:{data:{},method:"delete",url:`/list/environment/subscribe?workspace=${e}`,service:"sync"}}),abortController:n}})(n);e.abortController=r,e.asyncObserver=a,e.observer=await a,e.abortController=null,(0,d.invalidateCache)([p,n]),e.observer.subscribe({next:e=>{t(e,{workspaceId:n})},complete:()=>{e.unsubscribe()},error:async function(a){e.cleanup(),await e.subscribe({subscriptionHandler:t,workspaceId:n})}})},this.unsubscribe=()=>{var e,n;null==(e=this.abortController)||e.abort(),null==(n=this.observer)||n.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}},ne=(e,{workspaceId:n})=>{var t;const a=null==e||null==(t=e.data)?void 0:t.data;if(!Array.isArray(a))return;const r=[],o=[],s=[];for(const e of a)switch(e.action){case N.CREATE:o.push(e.id);break;case N.DELETE:r.push(e.id);break;case N.UPDATE:s.push(e.id)}o.length>0||s.length>0?(0,d.invalidateCache)([p,n]):r.length>0&&((e,n)=>{0!==e.length&&(0,d.updateCache)({key:[p,n],updater:n=>Array.isArray(n)?n.filter((n=>!e.includes(n.id))):n})})(r,n)},te=e=>{(0,c.useEffect)((()=>{if(e)return ee.subscribe({workspaceId:e,subscriptionHandler:ne}),()=>{ee.unsubscribe()}}),[e])},ae=()=>{const e=(0,c.useContext)(K);if(!e)throw new Error("useSetAsActiveEnvironment must be used within a VariablesProvider");const{data:n}=(0,d.useDataFetch)(e.collectionFetchOptions),t=n?$({model:"collection",modelId:n.id}):"",{setValue:a}=(0,r.useKVStorage)(j(),t);return{mutate:n=>{e.setActiveEnvironment(n),!e.useActiveEnvironmentFromContext&&t&&a(n)}}},re=e=>{const n=e.split(" "),t=n.length,a=n[t-1],r=Number.parseInt(a);return t>=2&&"Copy"===a?e+" 2":t>=3&&"Copy"===n[t-2]&&!Number.isNaN(r)?(n[t-1]=`${r+1}`,n.join(" ")):e+" Copy"},oe=(e,n="")=>{const t=new Set(e);let a=n;for(;t.has(a);)a=re(a);return a},se=()=>{const e=(0,d.useCacheClient)();return(0,d.useMutation)({mutationFn:e=>(async({environmentId:e,workspaceId:n})=>await m.postmanGateway.post({url:`${A().HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}/duplicate`,query:{workspace:n},data:{}}))(e),onMutate:async({workspaceId:n,environmentId:t})=>{const a=[p,n];await e.cancelQueries({queryKey:a});const r=e.getQueryData(a);if(!r)return;const{name:o}=r.find((({id:e})=>e===t));(0,d.updateCache)({key:a,updater:e=>e?[...e,{id:window.USER_ID+"-"+t,name:oe([o],o),isLoading:!0}]:e})},onSettled:(e,n,{workspaceId:t})=>{(0,d.invalidateCache)([p,t])}})},ie=(e="")=>{(0,c.useEffect)((()=>{if(e)return C.subscribe({environmentId:e,subscriptionHandler:L}),()=>{C.unsubscribe()}}),[e])},le=(e,n=new Set)=>t=>{var a;const r=e.findIndex(((e,a)=>e.key===t.key&&e.enabled===t.enabled&&!n.has(a)));let o;return-1===r?o={value:t.value}:(n.add(r),o=e[r]),{key:t.key,value:t.value,sessionValue:o.value,isSessionValueDeleted:null==(a=o)?void 0:a.deleted,enabled:t.enabled,type:t.type}},ce=(e,n)=>e.map(le(n)),ue=e=>e.reduce((({initialValues:e,sessionValues:n},t)=>{const{key:a,value:r,sessionValue:o,enabled:s,type:i,isSessionValueDeleted:l}=t;return n.push({key:a,value:o,enabled:s,type:i,deleted:!!l||void 0}),e.push({key:a,value:r,enabled:s,type:i}),{initialValues:e,sessionValues:n}}),{initialValues:[],sessionValues:[]}),de="secret",ve={queryKey:["empty-collection"],queryFn:()=>Promise.reject(),enabled:!1},me=(e,n,t=le(n))=>n=>n.map((n=>(0,I.Z)({},t(n),{scope:e}))),pe=()=>{var e;const n=(0,v.useActiveWorkspaceId)(),{collectionFetchOptions:t}=null!=(e=(0,c.useContext)(K))?e:{collectionFetchOptions:ve},{data:a}=(0,d.useDataFetch)(fn(n)),{data:r}=(0,d.useDataFetch)(Gn()),{data:o}=(0,d.useDataFetch)(t),{data:s}=B(),{data:i}=(0,d.useDataFetch)(gn(null==s?void 0:s.id)),l=(0,k.useSessionSafe)({model:"environment",modelId:null==i?void 0:i.id}),u=(0,k.useSessionSafe)({model:"globals",modelId:null==a?void 0:a.id}),m=(0,k.useSessionSafe)({model:"collection",modelId:null==o?void 0:o.id});return(0,c.useMemo)((()=>{var e,n,t,s,c,d,v,p,b,y;return{data:[...(y=r,y||[]),...me("globals",null!=(e=null==(n=u.value)?void 0:n.values)?e:[])(null!=(t=null==a?void 0:a.values)?t:[]),...me("collection",null!=(s=null==(c=m.value)?void 0:c.values)?s:[])(null!=(d=null==o?void 0:o.variables)?d:[]),...me("environment",null!=(v=null==(p=l.value)?void 0:p.values)?v:[])(null!=(b=null==i?void 0:i.values)?b:[])].map(((e,n)=>(0,I.Z)({},e,{id:`${e.scope}::${n}`})))}}),[o,m.value,i,l.value,a,u.value,r])},be=e=>{const n=e.filter((e=>"dynamic"===e.type));return[...e.filter((e=>"dynamic"!==e.type)),...n]},ye=e=>{const n=e.filter((e=>{return"boolean"!=typeof(n=e).enabled||n.enabled;var n})),t=(e=>{const n=new Map(e.map((e=>[e.key,e])));return e=>{const t=n.get(e.key);return t&&t.id!==e.id?(0,I.Z)({},e,{overriddenBy:{id:t.id,scope:t.scope}}):e}})(n),a=n.map((e=>t(e)));return{data:be(a)}},he=()=>{const{data:e}=pe();return(0,c.useMemo)((()=>{if(!e)return{};const n=e.filter((e=>"dynamic"!==e.type));return ye(n)}),[e])},Ee=()=>{const{data:e}=pe();return(0,c.useMemo)((()=>e?ye(e):{}),[e])},we=async({environmentId:e,name:n})=>await m.postmanGateway.put({url:`${A().HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}`,data:{name:n}}),ge=(e,n,t)=>{(0,d.updateCache)({key:e,updater:e=>e?e.map((e=>e.id===n?(0,I.Z)({},e,{name:t}):e)):e})},fe=()=>{const e=(0,d.useCacheClient)();return(0,d.useMutation)({mutationFn:e=>we(e),onMutate:async({workspaceId:n,environmentId:t,name:a})=>{const r=[p,n],o=e.getQueryData(r);if(!o)return;const s=o.find((({id:e})=>e===t));return ge(r,t,a),()=>{s&&ge(r,t,s.name)}},onSuccess:(e,{workspaceId:n,environmentId:t})=>{ge([p,n],t,e.data.name)},onError:(e,n,t)=>{t&&t()}})};var Ce=t(60607);const Ie=()=>{const{pathname:e}=(0,Z.useLocation)(),{environmentId:n}=(0,Ce.useParams)();return n||(null!=e&&e.endsWith("/globals")?"globals":void 0)},ke=()=>(0,d.useMutation)({mutationFn:({signal:e,environmentId:n,roles:t})=>(async({signal:e,environmentId:n,roles:t})=>await m.postmanGateway.put({url:`${A().HTTPS_GATEWAY_PRIVATE_URL}/environment/${n}/roles`,data:{roles:t},signal:e}))({signal:e,environmentId:n,roles:t}),onSuccess:(e,n)=>{n.onSuccess&&n.onSuccess(e)}});var Se=t(59530),Ae=t.n(Se),_e=t(20856),Te=t(88691),xe=t(80605),Re=t(29319);let Oe,Ne,Pe=e=>e;const De=Ae()(Re.Z)(Oe||(Oe=Pe`
  padding: 0 var(--spacing-xs);
`)),Le=Ae()(Te.Z)(Ne||(Ne=Pe`
  flex: 1;
  min-width: 0;

  button:first-child > span {
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }

  &:hover {
    .aether-split-button__splitter {
      border-left-color: var(--vscode-button-separator);
    }
  }
`)),Ve=({value:e,isLoading:n,onClick:t,isSecondaryButtonDisabled:a,onSecondaryButtonClick:r,ref:o})=>{const{label:s,forkLabel:i}=e,l=i?`${s} [${i}]`:s;return(0,Q.jsx)(Le,{ref:o,type:"secondary",minWidth:"0px",tooltip:l,text:l,secondaryButton:(0,Q.jsx)(xe.Z,{type:"secondary",icon:(0,Q.jsx)(De,{}),onClick:r,"data-testid":"quick-look-button",isDisabled:a}),isLoading:n,onClick:t})};let Fe;const Ue=Ae().div(Fe||(Fe=(e=>e)`
  display: flex;
  padding: var(--spacing-l);
  background-color: var(--highlight-background-color-secondary);
  border-radius: 0 0 var(--border-radius-default) var(--border-radius-default);
`)),$e=({text:e,isLoading:n,isDisabled:t,onClick:a})=>(0,Q.jsx)(Ue,{children:(0,Q.jsx)(xe.Z,{type:"text",text:e,onClick:a,isLoading:n,isDisabled:t})});var je=t(68206);let Me;const Ge=Ae()(je.Z)(Me||(Me=(e=>e)`
  border-color: transparent;
  border-radius: var(--border-radius-default) var(--border-radius-default) 0 0;

  &:active,
  &:focus,
  &:hover,
  &:focus-within {
    box-shadow: none;
    border-color: transparent;
  }
`)),Be=({value:e,onChange:n})=>{const t=u().useRef(null);return u().useEffect((()=>{t.current&&t.current.focus()}),[]),(0,Q.jsx)(Ge,{ref:t,type:"search",value:e,onChange:n,placeholder:"Search"})};var Qe=t(81397),Ke=t(37691);let qe,We,Ye,Ze=e=>e;const He=Ae().div(qe||(qe=Ze`
  box-sizing: border-box;
  display: flex;
  align-items: center;
  overflow: hidden;
  cursor: pointer;
`)),Xe=Ae().p(We||(We=Ze`
  flex: 2;
  margin: 0;
  margin-right: var(--spacing-s);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  max-width: fit-content;
`)),ze=Ae().p(Ye||(Ye=Ze`
  flex: 1;
  white-space: nowrap;
  overflow: hidden;
  margin: 0;
  margin-left: var(--spacing-xs);
  font-size: var(--text-size-s);
  font-weight: var(--text-weight-regular);
  text-overflow: ellipsis;
  color: var(--content-color-tertiary);
  max-width: fit-content;
`)),Je=({label:e,forkLabel:n})=>e?(0,Q.jsxs)(He,{children:[(0,Q.jsx)(Qe.Z,{content:e,openDelay:1e3,placement:"bottom",children:(0,Q.jsx)(Xe,{children:e})}),n&&(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(Ke.Z,{color:"content-color-tertiary",size:"small","data-testid":"fork-icon"}),(0,Q.jsx)(Qe.Z,{content:n,openDelay:1e3,placement:"bottom",children:(0,Q.jsx)(ze,{children:n})})]})]}):null;let en;const nn=Ae().div(en||(en=(e=>e)`
  flex: 1;
  color: var(--content-color-primary);
  min-height: 28px;
  box-sizing: border-box;
  padding: var(--spacing-xs) var(--spacing-s);
  border-radius: var(--border-radius-default);
  display: block;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
  cursor: pointer;
  user-select: none;

  ${0}

  &:hover {
    background-color: var(--highlight-background-color-secondary);
  }

  &:active {
    background-color: var(--highlight-background-color-tertiary);
  }
`),(({isSelected:e})=>e&&"background-color: var(--highlight-background-color-primary);")),tn=({isSelected:e,label:n,forkLabel:t,onSelect:a})=>(0,Q.jsx)(nn,{isSelected:e,role:"menuitem",onClick:a,tabIndex:0,onKeyPress:e=>{if("Enter"===e.key||" "===e.key)return e.preventDefault(),e.stopPropagation(),a()},children:(0,Q.jsx)(Je,{label:n,forkLabel:t})});let an,rn,on,sn,ln,cn=e=>e;const un=Ae().div(an||(an=cn`
  display: flex;
  flex-direction: column;
  max-height: 75vh;
  width: 90vw;
  max-width: 320px;
`)),dn=Ae().div(rn||(rn=cn`
  flex: 1;
  display: flex;
  flex-direction: column;
  padding: var(--spacing-s);
  overflow-y: auto;
  background: var(--background-color-primary);

  :empty::before {
    content: 'No items found';
    flex: 1;
    min-height: 28px;
    box-sizing: border-box;
    padding: var(--spacing-xs) var(--spacing-s);
    color: var(--content-color-tertiary);
  }
`)),vn=Ae().div(on||(on=cn`
  padding: var(--spacing-s) var(--spacing-l);
  color: var(--content-color-secondary);
  background-color: var(--highlight-background-color-secondary);
  font-weight: var(--text-weight-bold);
  user-select: none;
`)),mn=Ae().div(sn||(sn=cn`
  text-align: center;
  padding: var(--spacing-m);
`)),pn=Ae().div(ln||(ln=cn`
  border-radius: var(--border-radius-default) var(--border-radius-default) 0 0;
  ${0};
`),(e=>e.isBleed?" ":"border-bottom: var(--border-width-default) var(--border-style-solid) var(--border-color-default);")),bn=({options:e,onChange:n,value:t,isError:a,refetch:r,headerInfoText:o,isCreateNewLoading:s,isCreateNewDisabled:i,onCreateNew:l,createNewText:c="Create New"})=>{const[d,v]=u().useState(""),m=e.filter((({label:e})=>e.toLowerCase().includes(String(d).toLowerCase())));return(0,Q.jsxs)(un,{role:"menu",id:"selectormenu","aria-labelledby":"menubutton",children:[(0,Q.jsx)(pn,{isBleed:Boolean(o),children:(0,Q.jsx)(Be,{value:d,onChange:e=>v(e.target.value)})}),o&&(0,Q.jsx)(vn,{children:o}),a?(0,Q.jsxs)(mn,{children:["Failed to load. ",(0,Q.jsx)(xe.Z,{type:"text",text:"Retry",onClick:r})]}):(0,Q.jsx)(dn,{children:m.map((e=>(0,Q.jsx)(tn,{value:e.value,label:e.label,forkLabel:e.forkLabel,onSelect:()=>(v(""),n(e)),isSelected:e.value===t.value},e.value)))}),l&&(0,Q.jsx)($e,{text:c,onClick:l,isLoading:s,isDisabled:i})]})};let yn;const hn=Ae().div(yn||(yn=(e=>e)`
  display: flex;
  flex: 1;
  max-width: 260px;
`)),En=({value:e,options:n,onChange:t,isLoading:a,isError:r,refetch:o,headerInfoText:s,isCreateNewLoading:i,isCreateNewDisabled:l,onCreateNew:c,isQuickLookDisabled:d,onQuickLookClick:v,menuPlacement:m,"aria-label":p})=>{const[b,y]=u().useState(!1),h=(0,Q.jsx)(hn,{children:(0,Q.jsx)(Ve,{value:e,isLoading:a,onClick:()=>y((e=>!e)),isSecondaryButtonDisabled:d,onSecondaryButtonClick:()=>(b&&y(!1),v()),"aria-haspopup":"menu","aria-controls":"selectormenu","aria-expanded":b,"aria-label":p})});return(0,Q.jsx)(_e.ZP,{placement:m,trigger:h,isOpen:b,onClickOutside:()=>y(!1),padding:"0",appendTo:"parent",children:b&&(0,Q.jsx)(bn,{isCreateNewLoading:i,isCreateNewDisabled:l,onCreateNew:c,headerInfoText:s,options:n,isError:r,refetch:o,onChange:(...e)=>(y(!1),t(...e)),value:e})})},wn=e=>({queryKey:[b,e],queryFn:({signal:n})=>(async(e,{signal:n}={})=>{var t,a;if(!e)throw new Error("Invalid environment id");const r=await m.postmanGateway.get({url:`${A().HTTPS_GATEWAY_PRIVATE_URL}/environment/${e}`,signal:n});null==r||r.data;const o=_(r.data);return await(0,k.updateDependentSession)({model:"environment",modelId:o.id},o),(0,I.Z)({},o,{forkedFrom:null!=(t=null==(a=r.meta)?void 0:a.forkedFrom)?t:null})})(e,{signal:n}),useErrorBoundary:!1}),gn=e=>(0,I.Z)({},wn(null!=e?e:""),{enabled:!!e}),fn=e=>({queryKey:[h,e],queryFn:({signal:n})=>(async(e,{signal:n}={})=>{var t;const a=await m.postmanGateway.get({url:`${A().HTTPS_GATEWAY_PRIVATE_URL}/workspace/${e}/globals`,signal:n});if(!Array.isArray(null==a||null==(t=a.data)?void 0:t.values))throw new TypeError("Received invalid globals data from server");const r=a.data;return await(0,k.updateDependentSession)({model:"globals",modelId:r.id},r),r})(e,{signal:n}),useErrorBoundary:!1}),Cn=async({signal:e,permissionsPayload:n})=>{const t=await m.postmanGateway.post({url:`${A().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/api/permissions/check",service:"acs",data:{body:{checks:(0,I.Z)({},n)}},signal:e});if(null==t||!t.results)throw new Error("Received invalid permissions");return t.results},In="workspace",kn="ADD_ENVIRONMENT_TO_WORKSPACE",Sn="UPDATE_GLOBALS",An=(e,n)=>{const t={};for(const[a,r]of Object.entries(n))t[r]={entityId:window.USER_ID,entityType:"user",objectId:e,objectType:In,permission:a};return t},_n=e=>({queryKey:[y,E,e],queryFn:async({signal:n})=>{if(!window.USER_ID)return{userCanCreateEnvironment:!0,userCanUpdateGlobals:!0};const t={[kn]:`${In}/${e}/${kn}`,[Sn]:`${In}/${e}/${Sn}`},a=await Cn({signal:n,permissionsPayload:An(e,t)});return{userCanCreateEnvironment:a[t[kn]].allowed,userCanUpdateGlobals:a[t[Sn]].allowed}},useErrorBoundary:!1}),Tn="workspace",xn="ADD_ENVIRONMENT_TO_WORKSPACE",Rn="UPDATE_ENVIRONMENT",On="DELETE_ENVIRONMENT",Nn=e=>e.includes(Tn),Pn=(e,n)=>({queryKey:[w,e],queryFn:async({signal:t})=>{if(!window.USER_ID)return{userCanCreate:!0,userCanUpdate:!0,userCanDelete:!0};const a={[xn]:`${Tn}/${n}/${xn}`,[Rn]:`${e}:${Rn}`,[On]:`${e}:${On}`},r=((e,n,t)=>{const a={};for(const[r,o]of Object.entries(t))a[o]={entityId:window.USER_ID,entityType:"user",permission:r,objectId:Nn(o)?n:e,objectType:Nn(o)?Tn:"environment"};return a})(e,n,a),o=await Cn({signal:t,permissionsPayload:r});return{userCanCreate:o[a[xn]].allowed,userCanUpdate:o[a[Rn]].allowed,userCanDelete:o[a[On]].allowed}},useErrorBoundary:!1}),Dn="workspace",Ln="UPDATE_GLOBALS",Vn=(e,n)=>{const t={};for(const[a,r]of Object.entries(n))t[r]={entityId:window.USER_ID,entityType:"user",objectId:e,objectType:Dn,permission:a};return t},Fn=e=>({queryKey:[g,e],queryFn:async({signal:n})=>{if(!window.USER_ID)return{userCanUpdate:!0};const t={[Ln]:`${Dn}/${e}/${Ln}`};return{userCanUpdate:(await Cn({signal:n,permissionsPayload:Vn(e,t)}))[t[Ln]].allowed}},useErrorBoundary:!1}),Un="workspace",$n="ADD_ENVIRONMENT_TO_WORKSPACE",jn=e=>({queryKey:[f,e],queryFn:async({signal:n})=>{if(!window.USER_ID)return{userCanCreate:!0};const t={[$n]:`${Un}/${e}/${$n}`},a=((e,n)=>{const t={};for(const[a,r]of Object.entries(n))t[r]={entityId:window.USER_ID,entityType:"user",permission:a,objectId:e,objectType:Un};return t})(e,t);return{userCanCreate:(await Cn({signal:n,permissionsPayload:a}))[t[$n]].allowed}},useErrorBoundary:!1});var Mn=t(21466);const Gn=()=>({queryKey:["dynamic"],queryFn:()=>(async()=>await Mn.VSCodeCommunicationsService.postMessageToExtensionAsPromise({type:"FETCH_DYNAMIC_VARIABLES",payload:{}}))()}),Bn={userCanCreate:!0},Qn=e=>Boolean(e.isLoading);var Kn=t(80809);const qn="environment-selector-value-paint-mark",{PerfContext:Wn,PerformanceMarkPaint:Yn}=Kn.perfComponents,Zn=()=>{performance.measure("environment-selector-value-paint-time",{},qn),(0,Kn.sendMeasureEvent)({name:qn,entityType:"generic-selector"})},Hn=Object.freeze({label:"No Environment",value:"",forkLabel:""}),Xn=()=>{var e;const n=(0,Z.useNavigate)(),t=(0,v.useActiveWorkspaceId)(),a=(0,c.useContext)(K),r=a&&!a.useActiveEnvironmentFromContext;te(t);const{data:o,isError:s,refetch:i}=G({workspaceId:t}),l=!o,{data:u}=B(),m=ae(),p=(0,c.useMemo)((()=>{var e;return[Hn,...null!=(e=null==o?void 0:o.map((e=>{var n;const t=Qn(e)?null:null==(n=e.attributes)||null==(n=n.fork)?void 0:n.forkLabel;return{label:e.name,value:e.id,forkLabel:null!=t?t:""}})))?e:[]]}),[o]),b=J(),{isLoading:y,userCanCreate:h}=(()=>{const e=(0,v.useActiveWorkspaceId)(),{data:n,error:t}=(0,d.useDataFetch)(jn(e));return t?(0,I.Z)({isLoading:!1},Bn):n?(0,I.Z)({isLoading:!1},n):(0,I.Z)({isLoading:!0},Bn)})(),E=(e,a)=>{const r={rename:(null==a?void 0:a.showRenameOptionOnOpen)||!1};n(`/workspace/${t}/environment/${e}`,{state:JSON.stringify({additionalContext:r})},{customNavEvent:Z.OPEN_EXTENSION_URL})},w=null!=(e=p.find((e=>e.value===(null==u?void 0:u.id))))?e:Hn,g=l&&!s,{markName:f,callback:C}=(0,c.useContext)(Wn);return(0,Q.jsx)("div",{"data-testid":"active-environment-selector",children:(0,Q.jsx)(Yn,{condition:!g,markName:f||qn,callback:C||Zn,children:(0,Q.jsx)(En,{options:p,value:w,isLoading:g,isError:s,refetch:i,onChange:e=>{m.mutate(null!=e&&e.value?{id:e.value}:null)},menuPlacement:"bottom-end","aria-label":"active-environment",isQuickLookDisabled:!u||l,onQuickLookClick:()=>{u&&E(u.id)},headerInfoText:r?"Switch environment for the entire collection":void 0,isCreateNewLoading:b.isLoading||y,isCreateNewDisabled:!h,onCreateNew:()=>{b.mutate({workspaceId:t,requestBody:{id:(0,Y.v4)(),name:"New Environment",values:[]}},{onSuccess:({data:e})=>{H.AnalyticsService.addEventV2({category:"environment",action:"create",label:"environment-selector"}),E(`${e.owner}-${e.id}`,{showRenameOptionOnOpen:!0})}})}})})})},zn=e=>X()?(0,Q.jsx)(Xn,(0,I.Z)({},e)):null,Jn=e=>null==e?void 0:e.map((e=>({key:e.key,value:e.value,enabled:e.enabled,type:e.type}))),et=async(e,n)=>{if(!e.id)throw new Error("updateEnvironment: id is required");const t=(e=>{const{values:n}=e;return(0,I.Z)({},e,{values:Jn(n)})})(e),a=(r=(await m.postmanGateway.put({url:`${A().HTTPS_GATEWAY_PRIVATE_URL}/environment/${t.id}`,body:JSON.stringify({name:t.name,values:t.values})})).data,(0,I.Z)({},r,{id:`${r.owner}-${r.id}`}));var r;return null!=n&&n.avoidSession||await(0,k.updateDependentSession)({model:"environment",modelId:a.id},a),a},nt=()=>({mutationFn:et,onSuccess:e=>{d.cacheClient.setQueryData(["environment",e.id],e)}}),tt=()=>({mutationFn:async(e,n,t=!1)=>{const a=e.id;if(t)return await(0,k.setSession)({model:"environment",modelId:a},n),null;const[r]=await Promise.all([et(e,{avoidSession:!0}),(0,k.setSession)({model:"environment",modelId:a},n)]);return{environment:r}},onSuccess:e=>{if(e){const{environment:n}=e;(0,d.updateCache)({key:[b,n.id],updater:e=>e?(0,I.Z)({},e,n):e})}}}),at=e=>e.map((e=>({key:e.key,value:e.value,enabled:e.enabled,type:e.type}))),rt=e=>{const{values:n,workspace:t}=e;return{workspace:t,values:at(n)}},ot=async(e,n)=>{const t=e.workspace,a=(await m.postmanGateway.put({url:`${A().HTTPS_GATEWAY_PRIVATE_URL}/workspace/${t}/globals`,body:JSON.stringify(rt(e))})).data;return null!=n&&n.avoidSession||await(0,k.updateDependentSession)({model:"globals",modelId:a.id},a),a},st=()=>({mutationFn:ot,onSuccess:e=>{d.cacheClient.setQueryData([h,e.workspace],e)}}),it=()=>({mutationFn:async(e,n,t=!1)=>{if(t)return await(0,k.setSession)({model:"globals",modelId:e.id},n),null;const[a]=await Promise.all([ot(e,{avoidSession:!0}),(0,k.setSession)({model:"globals",modelId:e.id},n)]);return{globals:(0,I.Z)({},a,{workspace:e.workspace})}},onSuccess:e=>{if(e){const{globals:n}=e;(0,d.updateCache)({key:["globals",n.workspace],updater:n})}}}),lt=(e,n)=>{(0,d.updateCache)({key:e,updater:e=>e?(0,I.Z)({},e,{name:n}):e})},ct=()=>({mutationFn:e=>we(e),onMutate:async({environmentId:e,name:n})=>{const t=[b,e],a=d.cacheClient.getQueryData(t);return lt(t,n),()=>{a&&lt(t,a.name)}},onSuccess:(e,{environmentId:n})=>{lt([b,n],e.data.name)},onError:(e,n,t)=>{t&&t()}});async function ut(e,n,t){Mn.VSCodeCommunicationsService.postMessageToExtension({type:"RESOLVE_VARIABLES",payload:{objectToResolve:e,variables:n,id:t}})}const dt=async(...e)=>{const n=await et(...e);return(0,d.updateCache)({key:[b,n.id],updater:()=>n}),n},vt=async(...e)=>{const n=await ot(...e);return(0,d.updateCache)({key:[h,n.workspace],updater:()=>n}),n},mt=(0,k.createVariableUpdatesHandler)({model:"environment",hasEditPermission:async(e,{workspaceId:n})=>{var t;const a=await d.cacheClient.fetchQuery(Pn(e,n)).catch((()=>null));return null==(t=null==a?void 0:a.userCanUpdate)||t},getValues:async e=>await d.cacheClient.fetchQuery(wn(e)).catch((()=>null)),setValues:(e,n)=>dt({id:e,values:n})}),pt=(0,k.createVariableUpdatesHandler)({model:"globals",hasEditPermission:async(e,{workspaceId:n})=>{var t;const a=await d.cacheClient.fetchQuery(Fn(n)).catch((()=>null));return null==(t=null==a?void 0:a.userCanUpdate)||t},getValues:async(e,{workspaceId:n})=>await d.cacheClient.fetchQuery(fn(n)).catch((()=>null)),setValues:(e,n,{workspaceId:t})=>vt({id:e,values:n,workspace:t})}),bt=async e=>{if(!e)return;const n=await d.cacheClient.fetchQuery(wn(e));return(0,k.getActiveSession)({model:"environment",modelId:n.id},n)},yt=async e=>{const n=await d.cacheClient.fetchQuery(fn(e));return(0,k.getActiveSession)({model:"globals",modelId:n.id},n)};var ht=function(e){return e.GLOBALS="globals",e.WORKSPACE="workspace",e}(ht||{});const Et=(e,{workspaceId:n})=>{var t,a;const r=null==e||null==(t=e.meta)?void 0:t.model,o=null==e||null==(a=e.meta)?void 0:a.action;if(r===ht.GLOBALS&&o===O.UPDATE){const t=null==e?void 0:e.data;x(n,t)}r===ht.WORKSPACE&&o===D.UPDATE_ROLES&&(d.cacheClient.invalidateQueries({queryKey:[w]}),(0,d.invalidateCache)([g,n]))}}}]);
//# sourceMappingURL=2557.9e950863bd0afba3.js.map