"use strict";(self.webpackChunksidebar=self.webpackChunksidebar||[]).push([[9519],{27378:(e,t,i)=>{i.r(t),i.d(t,{ACTION_TYPES:()=>m,ANALYTICS_ACTION:()=>v,ENTITY_TYPE:()=>d,InviteToWorkspaceForm:()=>Ki,ROLE_TYPE:()=>u,SHARE_ACTIONS:()=>p,SHARE_SUPPORTED_MODEL:()=>h,ShareButton:()=>Di,generateInviteLink:()=>c,generateInvitePayloadTarget:()=>L,getActionData:()=>O,getActionForAnalytics:()=>D,getActionTypeAndData:()=>A,getEntityUrl:()=>C,getPermissionForEntity:()=>P,inviteViaEmail:()=>r,shareEntityWithTeamUser:()=>l});var s=i(7560),n=i(45860),a=i(26663),o=i.n(a);const r=async(e,t)=>{const i=(0,s.Z)({emails:e.users},e.target&&{target:e.target},e.type&&{type:e.type});return await n.postmanGateway.post({url:`${o().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:`/api/organizations/${e.teamId}/invites`,query:{user_id:e.userId},service:"god",data:{body:i},signal:t})},l=async(e,t)=>await n.postmanGateway.post({url:`${o().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:"/invite-requests",service:"collaboration",data:{body:e},signal:t}),c=async(e,t)=>await n.postmanGateway.put({url:`${o().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:`/api/organizations/${e.meta.teamId}/invites/generate_link`,service:"god",data:{body:{target:e}},signal:t});let d=function(e){return e.user="user",e.team="team",e.group="group",e}({}),u=function(e){return e.WORKSPACE_EDITOR="WORKSPACE_EDITOR",e.WORKSPACE_VIEWER="WORKSPACE_VIEWER",e.WORKSPACE_EDITOR_V9="WORKSPACE_EDITOR_V9",e.WORKSPACE_VIEWER_V9="WORKSPACE_VIEWER_V9",e.WORKSPACE_ANONYMOUS_EXPLORER="WORKSPACE_ANONYMOUS_EXPLORER",e.WORKSPACE_EXPLORER="WORKSPACE_EXPLORER",e}({}),p=function(e){return e.workspace_share_link="workspace:share_link",e.workspace_add_roles="workspace:add_role",e.workspace_share_public_link="workspace:share_public_link",e.collection_share_link="workspace:share_link::collection:share_link",e.collection_add_roles="workspace:add_role::collection:add_role",e.collection_share_public_link="workspace:share_public_link::collection:share_public_link",e.api_share_link="workspace:share_link::api:share_link",e.api_add_roles="workspace:add_role::api:add_role",e.api_share_public_link="workspace:share_public_link::api:share_public_link",e.environment_share_link="workspace:share_link::environment:share_link",e.environment_add_roles="workspace:add_role::environment:add_role",e.environment_share_public_link="workspace:share_public_link::environment:share_public_link",e}({}),m=function(e){return e.workspace_share_link="workspace:share_link",e.workspace_add_roles="workspace:add_role",e.workspace_share_public_link="workspace:share_public_link",e.collection_share_link="collection:share_link",e.collection_add_roles="collection:add_role",e.collection_share_public_link="collection:share_public_link",e.api_share_link="api:share_link",e.api_add_roles="api:add_role",e.api_share_public_link="api:share_public_link",e.environment_share_link="environment:share_link",e.environment_add_roles="environment:add_role",e.environment_share_public_link="environment:share_public_link",e}({}),h=function(e){return e.workspace="workspace",e.collection="collection",e.api="api",e.environment="environment",e.request="request",e.folder="folder",e.example="example",e}({}),v=function(e){return e.workspace_viewer="invite_ws:by_viewer",e.workspace_editor="invite_ws:by_editor",e.workspace_visitor="invite_ws:by_visitor",e.element_viewer="share_element:by_viewer",e.element_editor="share_element:by_editor",e.element_visitor="share_element:by_visitor",e}({});const _={[h.workspace]:{shareLink:{action:p.workspace_share_link,actionDataKeys:[m.workspace_share_link]},addRolesShare:{action:p.workspace_add_roles,actionDataKeys:[m.workspace_add_roles]},sharePublicLink:{action:p.workspace_share_public_link,actionDataKeys:[m.workspace_share_public_link]}},[h.collection]:{shareLink:{action:p.collection_share_link,actionDataKeys:[m.workspace_share_link,m.collection_share_link]},addRolesShare:{action:p.collection_add_roles,actionDataKeys:[m.workspace_add_roles,m.collection_add_roles]},sharePublicLink:{action:p.collection_share_public_link,actionDataKeys:[m.workspace_share_public_link,m.collection_share_public_link]}},[h.request]:{shareLink:{action:p.collection_share_link,actionDataKeys:[m.workspace_share_link,m.collection_share_link]},addRolesShare:{action:p.collection_add_roles,actionDataKeys:[m.workspace_add_roles,m.collection_add_roles]},sharePublicLink:{action:p.collection_share_public_link,actionDataKeys:[m.workspace_share_public_link,m.collection_share_public_link]}},[h.folder]:{shareLink:{action:p.collection_share_link,actionDataKeys:[m.workspace_share_link,m.collection_share_link]},addRolesShare:{action:p.collection_add_roles,actionDataKeys:[m.workspace_add_roles,m.collection_add_roles]},sharePublicLink:{action:p.collection_share_public_link,actionDataKeys:[m.workspace_share_public_link,m.collection_share_public_link]}},[h.example]:{shareLink:{action:p.collection_share_link,actionDataKeys:[m.workspace_share_link,m.collection_share_link]},addRolesShare:{action:p.collection_add_roles,actionDataKeys:[m.workspace_add_roles,m.collection_add_roles]},sharePublicLink:{action:p.collection_share_public_link,actionDataKeys:[m.workspace_share_public_link,m.collection_share_public_link]}},[h.api]:{shareLink:{action:p.api_share_link,actionDataKeys:[m.workspace_share_link,m.api_share_link]},addRolesShare:{action:p.api_add_roles,actionDataKeys:[m.workspace_add_roles,m.api_add_roles]},sharePublicLink:{action:p.api_share_public_link,actionDataKeys:[m.workspace_share_public_link,m.api_share_public_link]}},[h.environment]:{shareLink:{action:p.environment_share_link,actionDataKeys:[m.workspace_share_link,m.environment_share_link]},addRolesShare:{action:p.environment_add_roles,actionDataKeys:[m.workspace_add_roles,m.environment_add_roles]},sharePublicLink:{action:p.environment_share_public_link,actionDataKeys:[m.workspace_share_public_link,m.environment_share_public_link]}}},g={collection:"collection",extensibleCollection:"collection",environment:"environment",api:"API",monitor:"monitor",workspace:"workspace",mock:"mock server",request:"request",folder:"folder"},y="go",b={WORKSPACE_EDITOR:"Editor",WORKSPACE_VIEWER:"Viewer",WORKSPACE_EDITOR_V9:"Editor",WORKSPACE_VIEWER_V9:"Viewer",WORKSPACE_ANONYMOUS_EXPLORER:"Viewer",WORKSPACE_EXPLORER:"Viewer"},k=(e,t)=>t?`Move this ${e} to a new private workspace`:`Move this ${e} to a new team workspace`,w=(e,t)=>t?`Only this ${e} will be shared with invited people.`:`Only this ${e} will be shared with your team.`,f=()=>"move_to_new_workspace",x=(e,t)=>t?"Change the visibility of this workspace to private":"Change the visibility of this workspace to team",E=(e,t)=>t?"Everything in this workspace will be shared with invited people.":"Everything in this workspace will be shared with your team.",R=()=>"convert_workspace",I="move_to_new_workspace";function T(e,t){return t.split(".").reduce(((e,t)=>null==e?void 0:e[t]),e)}function S(e,t,i){return[...e].sort(((e,s)=>{for(const[n,a]of t.entries()){const t=i[n],o=T(e,a),r=T(s,a);if(o<r)return"desc"===t?1:-1;if(o>r)return"desc"===t?-1:1}return 0}))}const j=(e,t,i)=>Array.isArray(e)?0===e.length?i:e.reduce(((e,i,s,n)=>t(e,i,s,n)||e),i):"object"==typeof e?0===Object.keys(e).length?i:Object.keys(e).reduce(((i,s,n,a)=>t(i,e[s],s,a)||i),i):i,O=(e,t,i,n,a,o,r,l,c)=>a.reduce(((a,d)=>o&&d.includes(h.workspace)&&r?(a[d]=(0,s.Z)({model:h.workspace,modelId:r.id},n&&{role:r.role}),a):(a[d]=(0,s.Z)({model:e,modelId:t},c&&{activeEnvironment:c},n&&{role:i},l&&{subEntityId:l.subEntityId,subEntityModel:l.subEntityModel,subEntityName:l.subEntityName}),a)),{}),A=e=>{const{model:t,modelId:i,canUpdateRoles:s,role:n,addWorkspaceContext:a,workspaceDetails:o,sharePublicContext:r,subEntityInfo:l,activeEnvironment:c}=e;let d,u,p;return r?(d=_[t].sharePublicLink.action,u=_[t].sharePublicLink.actionDataKeys,p=!1):s?(d=_[t].addRolesShare.action,u=_[t].addRolesShare.actionDataKeys,p=!0):(d=_[t].shareLink.action,u=_[t].shareLink.actionDataKeys,p=!1),{action:d,actionData:O(t,i,n,p,u,a,o,l,c)}},C=(e,t,i,n,a,r)=>{const l=`https://${a}${o().ARTEMIS_URL.replace("https://go","")}`,c=((e,t)=>{let i=t.slice(0,31);return i=i.replace(/\s+/g,"-"),i=i.replace(/~/g,"-"),i=encodeURIComponent(i),`${i}~${e}`})(n.id,n.name);if("workspace"===t)return`${l}/workspace/${c}`;const d=!!r;return`${l}/workspace/${c}/${t}/${e}?${new URLSearchParams((0,s.Z)({},{action:"share",creator:i},d&&{"active-environment":r})).toString()}`},L=(e,t,i,n,a,o,r,l,c,d,u)=>{if(!r)throw new Error("Workspace info not found");const{action:p,actionData:m}=A({model:e,modelId:t,canUpdateRoles:d,role:c,addWorkspaceContext:e!==h.workspace,workspaceDetails:{id:r.id,role:l}}),v={continue_url:"",meta:{},notification_vars:{}};var _;return v.continue_url=C(t,e,a,r,o,u),v.meta={action:p,actionData:m,actorId:a,teamId:n},v.notification_vars=(0,s.Z)({},d&&{role_name:c},{model_name_label:(_=e,_.charAt(0).toUpperCase()+_.slice(1)),model_name:h.workspace,object_name:i,visibility:null==r?void 0:r.visibilityStatus,context:e!==h.workspace}),v},P=(e,t)=>({collection:{update:"UPDATE_COLLECTION_ROLES"},environment:{update:"UPDATE_ENVIRONMENT_ROLES"},folder:{update:"UPDATE_FOLDER_ROLES"},request:{update:"UPDATE_REQUEST_ROLES"},workspace:{update:"UPDATE_WORKSPACE_ROLES"}}[e][t]),D=(e,t)=>e===h.workspace?t.includes("share_link")?v.workspace_viewer:t.includes("add_role")?v.workspace_editor:v.workspace_visitor:t.includes("share_link")?v.element_viewer:t.includes("add_role")?v.element_editor:v.element_viewer;var N=i(40540),V=i.n(N),W=i(59530),Z=i.n(W),U=i(20856),M=i(80429),$=i(16185),K=i(96364),B=i(16669),G=i(21180),Y=i(35736),F=i(52322);let z;const H=Z().div(z||(z=(e=>e)`
  display: flex;
  align-items: center;
  justify-content: center;
`));function q(){return(0,F.jsx)(H,{children:(0,F.jsx)(Y.Z,{})})}var X=i(14350),Q=i(80346),J=i(29342),ee=i(10099),te=i(22833),ie=i.n(te),se=i(74269),ne=i(91214),ae=i(37110),oe=i(58560),re=i(9460),le=i(81397),ce=i(72372),de=i(11437),ue=i(24867);const pe=({userId:e})=>{const{data:t,isLoading:i}=(0,B.usePublicProfile)({userIds:[`${e}`],type:"user"}),s=null==t?void 0:t[e],n=(null==s?void 0:s.name)||(null==s?void 0:s.username)||(null==s?void 0:s.email);return i?(0,F.jsx)(q,{}):(0,F.jsxs)("div",{className:"permission-list-item__members-list__content__item",children:[(0,F.jsx)(ne.Z,{size:"s",src:null==s?void 0:s.profile_pic_url}),(0,F.jsx)("div",{className:"permission-list-item__members-list__content__item__name",title:n,children:n})]})};let me,he,ve=e=>e;const _e=Z().div(me||(me=ve`
  display: flex;
  flex-direction: column;
  gap: var(--spacing-s);
  min-width: max-content;

  height: ${0};
  color: ${0};

  opacity: ${0};

  :hover {
    cursor: ${0};
  }
`),(({isDestructive:e})=>e&&"32px"),(({isDestructive:e})=>e&&"var(--content-color-error)"),(({isDisabled:e})=>e?"0.5":"1"),(({isDisabled:e})=>e?"default":"pointer")),ge=Z().div(he||(he=ve`
  width: fit-content;
`)),ye=({label:e,description:t,isDestructive:i,state:s})=>{var n;const a=null==s?void 0:s.isBlocked.status,o=a?le.Z:V().Fragment;return(0,F.jsx)(o,{placement:"bottom",content:a?null==s||null==(n=s.isBlocked)?void 0:n.detail:"",children:(0,F.jsxs)(_e,{"data-testid":"role-dropdown-option",isDestructive:i,isDisabled:a,children:[(0,F.jsx)(re.ZP,{typographyStyle:{fontSize:"text-size-m",fontWeight:"text-weight-regular",lineHeight:i?"line-height-xxl":"line-height-m"},children:e}),t&&(0,F.jsx)(ge,{children:(0,F.jsx)(re.ZP,{color:"content-color-secondary",typographyStyle:{fontSize:"text-size-s",fontWeight:"text-weight-regular",lineHeight:"line-height-s"},children:t})})]})})};let be,ke,we=e=>e;const fe=Z().div(be||(be=we`
  display: flex;
  padding-left: var(--spacing-s);
  align-items: center;
  float: right;
  margin-left: auto;
`)),xe=Z()(se.Z)(ke||(ke=we`
  .aether-dropdown__menu {
    width: fit-content !important;
  }

  .aether-dropdown__control--is-disabled {
    background-color: var(--background-color-primary);
    border: none;

    &--is-focused {
      border: none;
      box-shadow: none;

      &:hover {
        border-right: none;
        border: none;
      }
    }

    &:hover {
      border: none;
      transition: none;
      -webkit-transition: none;
    }
  }
`)),Ee=(0,N.memo)((({infoText:e,selectedRole:t,rolesList:i,orderedRoleList:n,member:a,subTitle:o,isTeam:r,isGuest:l,isPartner:c,canModifyMembers:d,isUserGroup:u,onChange:p,onRemove:m,teamData:h,dataTestId:v,canManageRolesOnEntity:_})=>{const g=(0,N.useRef)(null),[y,b]=(0,N.useState)({value:t,label:t}),[k,w]=(0,N.useState)(0),[f,x]=(0,N.useState)(""),[E,R]=(0,N.useState)([]),I=a.isPlaceholder;(0,N.useEffect)((()=>{var e;t!==y.label&&b({value:t,label:(null==(e=i[t])?void 0:e.displayName)||t})}),[t]);const T=d&&("boolean"!=typeof a.canRemove||a.canRemove);return(0,N.useEffect)((()=>{var e,t;const i=null==h||null==(e=h.user_groups)?void 0:e.find((e=>`${e.id}`==`${a.id}`));w((null==h||null==(t=h.user_groups)?void 0:t.length)||0),x(`${k} member${k>1?"s":""}`),R((null==i?void 0:i.members)||[])}),[h,a,k]),(0,F.jsxs)(F.Fragment,{children:[u&&g.current&&(0,F.jsxs)(U.ZP,{triggerRef:g,triggerEvent:"click",placement:"left",padding:"spacing-xl",pointer:!0,children:[(0,F.jsxs)("div",{className:"permission-list-item__members-list__title",children:[(0,F.jsx)("div",{className:ie()({"permission-list-item__members-list__title__group-name":!0,"permission-list-item__members-list__title__no-members":!k}),title:a.name,children:a.name})," ",k>0&&(0,F.jsxs)("div",{children:["(",f,")"]})]}),(0,F.jsx)("div",{className:ie()({"permission-list-item__members-list__content":!0,"permission-list-item__members-list__no-members":!k}),children:k>0?E.map((e=>(0,F.jsx)(pe,{userId:e},e))):(0,F.jsx)("div",{className:"permission-list-item__members-list__content__no-members",children:(0,F.jsx)(ae.Z,{type:"secondary",text:"No members in this group."})})})]}),(0,F.jsxs)("div",{className:"permission-list-item-v2","data-testid":v,children:[(0,F.jsxs)("div",{ref:g,className:"permission-list-item-v2-container",children:[I?a.icon:u?(0,F.jsx)(de.Z,{className:"permission-list-item__user-group",color:"content-color-secondary"}):(0,F.jsx)(ne.Z,{src:a.profile_pic_url,size:"s",userId:a.id}),(0,F.jsxs)("div",{className:ie()({"permission-list-item--name":!0,"permission-list-item--name__user-group":u}),children:[(0,F.jsxs)(oe.Z,{gap:"spacing-s",alignItems:"center",children:[(0,F.jsx)(re.ZP,{color:"content-color-primary",isTruncated:!0,children:a.name}),l&&(0,F.jsx)(le.Z,{content:"Guests can only view collections shared with them.",placement:"right",children:(0,F.jsx)("div",{children:(0,F.jsx)(ce.Z,{text:"Guest",color:"grey"})})}),c&&(0,F.jsx)(ce.Z,{text:"Partner",color:"grey"})]}),o&&(0,F.jsx)(re.ZP,{color:"content-color-secondary",children:o})]})]}),(0,F.jsxs)(fe,{children:[e&&(0,F.jsx)("div",{className:"permission-list-item--info","data-testid":"role-list-item-info-text",children:(0,F.jsx)(le.Z,{content:e,maxWidth:300,placement:"left",children:(0,F.jsx)(ue.Z,{})})}),(0,F.jsx)("div",{className:(S=T,ie()({"permissions-list-item--permissions":!0,"permission-list-item--user":!0,"can-remove":S})),children:(0,F.jsx)(xe,{onChange:e=>{var t;if(null!=(t=e.state)&&null!=(t=t.isBlocked)&&t.status)return;let i="user";if(u&&(i="group"),r&&(i="team"),"remove"===e.value)return null==m?void 0:m(i,a.id);p&&p(a.id,i,e.value)},options:(()=>{const e=n.map((e=>(0,s.Z)({},e,{label:e.displayName,value:e.name,isDestructive:!1,state:e.state})));return T&&e.push({displayName:"Remove",description:"",isEnabled:!0,name:"Remove",permissions:[],state:{isBlocked:{status:!1,detail:"You don’t have permission to perform this action"},isInvalid:{status:!1,detail:"You don’t have permission to perform this action"}},label:"Remove",value:"remove",isDestructive:!0}),e})(),value:y,customOptionComponent:ye,isClearable:!1,isSearchable:!1,triggerType:"tertiary",triggerWidth:"auto",menuPlacement:"bottom-end",menuMaxWidth:500,dataTestId:"role-list-item-roles-dropdown",isDisabled:!_||!a.id})})]})]})]});var S}));let Re;const Ie=Z().div(Re||(Re=(e=>e)`
  display: flex;
  align-items: center;
  justify-content: center;
  height: var(--size-s);
  width: var(--size-s);
`)),Te=({fallbackRole:e,canModifyMembers:t,selectedUserRoles:i,selectedUserGroupsRoles:s,rolesList:n,guestRoles:a,partnerRoles:o,orderedRoleList:r,orderedGuestRoleList:l,orderedPartnerRoleList:c,teamRole:d,members:u,userGroups:p,entityType:m,roleValidations:h,teamData:v,onChange:_,onRemove:y,canManageRolesOnEntity:b,workspaceVisibility:k})=>{const w=(t,i,s)=>{var r;let l;return l=i?a:s?o:n,(null==(r=l)||null==(r=r[t])?void 0:r.displayName)||e},f=(e,t)=>{var i;return!1===(null==(i=h[`${e}_${t}`])?void 0:i.valid)?"user"===e?`This ${e} has edit permission on this ${g[m]} which they are inheriting from the workspace or a group.`:`This ${e} has edit permission on this ${g[m]} which they are inheriting from the workspace.`:""},x=u.map((e=>(({id:e,canRemove:t})=>{var i;if((0,B.isUserGuest)(e,v)){var s;const i=null==v||null==(s=v.guest_members)?void 0:s.find((t=>t.id===e));return{id:e,name:(null==i?void 0:i.name)||(null==i?void 0:i.username)||(null==i?void 0:i.email)||"",email:(null==i?void 0:i.email)||"",canRemove:t,profile_pic_url:null==i?void 0:i.profile_pic_url}}if((0,B.isUserPartner)(e,v)){var n;const i=null==v||null==(n=v.partner_members)?void 0:n.find((t=>t.id===e));return{id:e,name:(null==i?void 0:i.name)||(null==i?void 0:i.username)||(null==i?void 0:i.email)||"",email:(null==i?void 0:i.email)||"",canRemove:t,profile_pic_url:null==i?void 0:i.profile_pic_url}}const a=null==v||null==(i=v.team_users)?void 0:i.find((t=>t.id===e));return{id:e,name:(null==a?void 0:a.name)||(null==a?void 0:a.username)||(null==a?void 0:a.email)||"",email:(null==a?void 0:a.email)||"",canRemove:t,profile_pic_url:null==a?void 0:a.profile_pic_url}})(e)));return(0,F.jsx)("div",{className:"permission-list-v2-container",children:(0,F.jsxs)("div",{className:"permission-list",children:[(()=>{const e=Object.keys(d||{}).length>0&&(null==v?void 0:v.name);if(!v)return null;if(k===ee.VISIBILITY_STATUS.team){var t;const i={id:null==d?void 0:d.id,name:e?`Everyone at ${e} team`:"Everyone at team",canRemove:!1,totalMembers:null==v||null==(t=v.team_users)?void 0:t.length,profile_pic_url:null==v?void 0:v.logo_url};return(0,F.jsx)(Ee,{canManageRolesOnEntity:b,infoText:f("team",null==d?void 0:d.id),selectedRole:w(null==d?void 0:d.name),rolesList:n,orderedRoleList:r,member:i,onChange:_,subTitle:i.totalMembers>1?`${i.totalMembers} team members`:"1 team member",teamData:v,isTeam:!0,dataTestId:"team-role-list-item"},i.id)}var i,s;return k===ee.VISIBILITY_STATUS.private?(0,F.jsx)(Ee,{infoText:"",selectedRole:"Viewer",rolesList:n,orderedRoleList:r,member:{id:v.id,name:"Only invited people from the team",canRemove:!1,totalMembers:null==(i=v.team_users)?void 0:i.length,profile_pic_url:"",isPlaceholder:!0,icon:(0,F.jsx)(Ie,{children:(0,F.jsx)(Q.Z,{})})},onChange:_,subTitle:"",teamData:v,isTeam:!0,dataTestId:"team-role-list-item"},"placeholder-team"):k===ee.VISIBILITY_STATUS.public?(0,F.jsx)(Ee,{infoText:"",selectedRole:"Viewer",rolesList:n,orderedRoleList:r,member:{id:v.id,name:"Anyone on the internet",canRemove:!1,totalMembers:null==(s=v.team_users)?void 0:s.length,profile_pic_url:"",isPlaceholder:!0,icon:(0,F.jsx)(Ie,{children:(0,F.jsx)(J.Z,{})})},onChange:_,subTitle:"",teamData:v,isTeam:!0,dataTestId:"team-role-list-item"},"placeholder-team"):null})(),Object.keys(p).map((e=>{const i=p[e],a=(o=i.id,null==(l=s[o])?void 0:l.name);var o,l;return(0,F.jsx)(Ee,{canManageRolesOnEntity:b,infoText:f("group",i.id),canModifyMembers:t,selectedRole:w(a),rolesList:n,orderedRoleList:r,member:i,onChange:_,teamData:v,onRemove:y,subTitle:i.members.length>1?`${i.members.length} group members`:"1 group member",dataTestId:"user-group-role-list-item",isUserGroup:!0},i.id)})),x.map((e=>{const s=(0,B.isUserGuest)(e.id,v),a=(0,B.isUserPartner)(e.id,v),o=(d=e.id,null==(u=i[d])?void 0:u.name);var d,u;let p=[];return p=s?l:a?c:r,(0,F.jsx)(Ee,{canManageRolesOnEntity:b,infoText:f("user",e.id),canModifyMembers:t,selectedRole:w(o,s,a),rolesList:n,orderedRoleList:p,member:e,onChange:_,onRemove:y,subTitle:e.email,isGuest:s,isPartner:a,teamData:v,dataTestId:"user-role-list-item"},e.id)}))]})})},Se=(0,N.createContext)({}),je=({children:e})=>{const[t,i]=(0,N.useState)({name:"No Environment",id:"No Environment"}),[s,n]=(0,N.useState)([]),[a,o]=(0,N.useState)({}),[r,l]=(0,N.useState)([]),[c,d]=(0,N.useState)(!1),[u,p]=(0,N.useState)(),{data:m,isLoading:h}=(0,ee.useActiveWorkspaceInfo)();return(0,N.useEffect)((()=>{m&&p(m.visibilityStatus)}),[h,m]),(0,F.jsx)(Se.Provider,{value:{selectedInvitees:s,setSelectedInvitees:n,selectedRole:a,setSelectedRole:o,roleOptions:r,setRoleOptions:l,isRoleOptionsLoading:c,setIsRoleOptionsLoading:d,selectedEnvironment:t,setSelectedEnvironment:i,getInvalidEmailCount:()=>s.filter((e=>e.isInvalid)).length,workspaceInfo:m,isWorkspaceInfoLoading:h,workspaceVisibility:u,setWorkspaceVisibility:p},children:e})};var Oe=i(53186),Ae=i(98276);const Ce=(0,N.memo)((({canModifyMembers:e,entityType:t,entityId:i,teamData:n,rolesResponse:a,rolesForObjectTypeResponse:o,defaultRolesResponse:r,canManageRolesOnEntity:l,workspaceRoles:c,workspaceVisibility:d})=>{const{setRoleOptions:u,setSelectedRole:p,selectedRole:m}=(0,N.useContext)(Se),[v,_]=(0,N.useState)({}),[g,y]=(0,N.useState)({}),[k,w]=(0,N.useState)({}),[f,x]=(0,N.useState)({}),[E,R]=(0,N.useState)([]),[I,T]=(0,N.useState)({}),[O,A]=(0,N.useState)({}),[C,L]=(0,N.useState)({}),[P,D]=(0,N.useState)([]),[V,W]=(0,N.useState)({}),Z=(()=>{const e=(0,Oe.useUpdateCollectionRoles)(),t=(0,Ae.useUpdateEnvironmentRoles)(),{addToast:i}=(0,K.ZP)(),s=e=>{i({status:"error",description:`Could not update the roles on this ${e}. Please try again.`})};return(i,n,a,o,r)=>{const l=(0,X.getRolesData)(i,n,a,o,r);switch(i){case h.collection:e.mutate({collectionId:n,roles:l},{onError:()=>s(i)});break;case h.environment:t.mutate({environmentId:n,roles:l},{onError:()=>s(i)})}}})(),U=(0,X.useFetchAssociatedRoles)(),M=null==n?void 0:n.id,$=async e=>{const n={},a=(0,s.Z)({},C);if(e.length>0){for(const s of e){const{memberType:e,memberId:a,role:o}=s;n[`${e}_${a}`]={entityId:a,entityType:e,objectId:i,objectType:t,role:o}}try{const e=await(0,X.validateRolesAssignment)({validationCriteria:n});L((0,s.Z)({},a,e.results))}catch(e){}}},B=e=>E.reduce(((t,i)=>{const s=null==e?void 0:e[i];return s&&t.push(s),t}),[]),G=(e,s,n)=>{Z(t,i,e,s,n)};return(0,N.useEffect)((()=>{let e={};const{defaultRoles:i,rolesList:l,userCurrentRoles:h,teamCurrentRoles:v,groupCurrentRoles:g,rolesOrder:k,guestRoles:f,partnerRoles:E}=U(t,a,o,null==r?void 0:r.data);var I;0===Object.keys(v).length&&"team"===d&&(e=j(null==c||null==(I=c.listing)?void 0:I.team,((e,t,i)=>{var s;const n=b[null==t||null==(s=t.roles)?void 0:s[0]];if(n){const[,t]=Object.entries(l).find((([,e])=>e.displayName===n))||[];e[i]={type:"team",id:i,name:null==t?void 0:t.name}}return e}),{})),_(l),y(h),w(g),R(k),T(f),A(E),x(v[M]||e[M]);const O=(0,s.Z)({},h,v,g),C=[];for(const[e,t]of Object.entries(O))C.push({memberType:t.type,memberId:e,role:t.name});$(C);const L=(null==n?void 0:n.user_groups)||[],{userGroupRoles:P}=(0,X.segregateGroupRoles)(g,L),N=(0,X.getUserGroupsFromRoles)(P,L),V=Object.keys(h).map((e=>({id:e})));D(V),W(N);const Z=S(k.reduce(((e,t)=>{const i=l[t];return i&&e.push(i),e}),[]),["state.isBlocked.status"],["asc"]);u(Z.map((e=>({label:e.displayName,value:e.name,state:e.state}))));const K=Z.find((e=>e.name===i.user));m.label||p({label:(null==K?void 0:K.displayName)||Z[0].displayName,value:(null==K?void 0:K.name)||Z[0].name})}),[a,c]),(0,F.jsx)("div",{className:"modify-permissions-body","data-testid":"manage-roles-container",children:(0,F.jsx)("div",{className:"modify-permissions",children:(0,F.jsx)("div",{className:"modify-permissions--editor",children:(0,F.jsx)("div",{className:"modify-permissions--roles-container",children:(0,F.jsx)(Te,{fallbackRole:"Select Role",canModifyMembers:e,selectedUserRoles:g,selectedUserGroupsRoles:k,rolesList:v,guestRoles:I,partnerRoles:O,orderedRoleList:S(B(v),["state.isBlocked.status"],["asc"]),orderedGuestRoleList:S(B(I),["state.isBlocked.status"],["asc"]),orderedPartnerRoleList:S(B(O),["state.isBlocked.status"],["asc"]),disabledRoleTooltipText:`You can only assign users an ${j(v,((e,t)=>(t.isEnabled&&e.push(t.displayName),e)),[]).join(" ,")} role on this ${t}. Your plan doesn’t include access management.`,teamRole:f,members:P,userGroups:V,onChange:async(e,t,i)=>{const n=(0,s.Z)({},g),a=(0,s.Z)({},k);let o=(0,s.Z)({},f);switch(t){case"user":n[e]={id:e,type:t,name:i},y(n);break;case"group":a[e]={id:e,type:t,name:i},w(a);break;case"team":o={type:t,id:M,name:i},x(o)}$([{memberType:t,memberId:e,role:i}]),G(n,a,o)},onRemove:(e,t)=>{const i=(0,s.Z)({},g),n=(0,s.Z)({},k);switch(e){case"user":{const e=P.filter((e=>e.id!==t));delete i[t],y(i),D(e);break}case"group":{const e=(0,s.Z)({},V);delete n[t],delete e[t],w(n),W(e);break}}$([]),G(i,n,f)},entityType:t,entityId:i,roleValidations:C,teamData:n,canManageRolesOnEntity:l,workspaceVisibility:d})})})})})})),Le=(0,N.memo)((({entityType:e,entityId:t,canManageRolesOnEntity:i,workspaceVisibility:s,isWorkspaceInfoLoading:n})=>{const{setIsRoleOptionsLoading:a}=(0,N.useContext)(Se),{data:o,isLoading:r,isRefetching:l}=(0,X.useFetchDefaultRolesForObjectType)(e,!0,!0),{data:c,isLoading:d}=(0,X.useFetchRolesForObject)(e,t,!0,!0),{data:u,isLoading:p,isRefetching:m}=(0,X.useFetchRolesForObjectType)(e,!0,!0),{data:h,isLoading:v,isRefetching:_}=(0,B.useTeamsByUserId)(),g=(0,ee.useActiveWorkspaceId)(),{data:y,isLoading:b,isRefetching:k}=(0,ee.useWorkspaceRoles)(g),w=r||d||p||v||b||n||l||m||k||_;return(0,N.useEffect)((()=>{a(w)}),[w]),w?(0,F.jsx)(q,{}):(0,F.jsx)(G.CustomErrorBoundary,{appId:"collaboration-service",errorElementId:"manage-roles-container",fallback:(0,F.jsx)(G.GenericErrorMessage,{title:`Coundn't load roles for the ${e}`,description:"Just a faulty wire. Try reloading.",illustration:"illustration-internal-server-error"}),children:(0,F.jsx)(Ce,{canModifyMembers:!0,entityType:e,entityId:t,teamData:null==h?void 0:h.organizations[0],rolesResponse:c,rolesForObjectTypeResponse:u,defaultRolesResponse:o,canManageRolesOnEntity:i,workspaceRoles:y,workspaceVisibility:s})})}));var Pe=i(20455);let De,Ne,Ve,We,Ze=e=>e;const Ue=Z().div(De||(De=Ze`
  display: flex;
  flex-direction: row;
  align-items: center;
  height: 40px;
  padding-left: var(--spacing-xl);
  padding-right: var(--spacing-xl);
`)),Me=Z().div(Ne||(Ne=Ze`
  display: flex;
  align-items: center;
  margin-left: var(--spacing-xs);
  width: var(--size-s);
  justify-content: center;
`)),$e=Z().div(Ve||(Ve=Ze`
  display: flex;
  float: right;
  margin-left: auto;
  margin-right: var(--spacing-xs);
`)),Ke=Z().div(We||(We=Ze`
  margin-left: var(--spacing-s);
  color: var(--content-color-primary);
`)),Be=({entityType:e})=>{const t=(0,ee.useActiveWorkspaceId)(),{selectedEnvironment:i,setSelectedEnvironment:s}=(0,N.useContext)(Se),{data:n,isLoading:a}=(0,Ae.useEnvironmentItems)({workspaceId:t});return(0,N.useEffect)((()=>{s({id:"No Environment",name:"No Environment"})}),[]),e!==h.collection?null:(0,F.jsxs)(Ue,{"data-testid":"share-with-environment-container",children:[(0,F.jsx)(Me,{children:(0,F.jsx)(Pe.Z,{})}),(0,F.jsx)(Ke,{children:"Share with Environment"}),(0,F.jsx)($e,{children:(0,F.jsx)(se.Z,{onChange:e=>(e=>{if("No Environment"===e.value)return void s({name:"No Environment",id:"No Environment"});const t=null==n?void 0:n.find((t=>t.id===(null==e?void 0:e.value)));s({name:t.name,id:t.id})})(e),options:(()=>{const e=[{label:"No Environment",value:"No Environment"}];for(const t of n||[])e.push({label:t.name,value:t.id});return e})(),value:{label:i.name,value:i.id},isSearchable:!1,isClearable:!1,triggerType:"tertiary",placeholder:"Select Environment",isLoading:a,menuPlacement:"bottom-end",triggerMaxWidth:"200px"})})]})};let Ge,Ye,Fe=e=>e;const ze=Z().div(Ge||(Ge=Fe`
  height: 1px;
  background-color: var(--border-color-default);
  width: 100%;
`)),He=Z().div(Ye||(Ye=Fe`
  height: ${0};
  padding-left: var(--spacing-xl);
  padding-right: var(--spacing-xl);
  display: flex;
  align-items: center;
`),(e=>e.height)),qe=({height:e})=>(0,F.jsx)(He,{height:e,children:(0,F.jsx)(ze,{})});var Xe=i(38394),Qe=i(95617);const Je=({teamId:e,userId:t,entityId:i,entityType:s})=>{const{selectedEnvironment:n}=(0,N.useContext)(Se),[a,o]=(0,N.useState)(!1),{data:r,isLoading:l}=(0,ee.useActiveWorkspaceInfo)(),{data:c,isLoading:d}=(0,B.useTeamsByUserId)(),u=a?(0,F.jsx)(Xe.Z,{}):(0,F.jsx)(Qe.Z,{});return e&&r?(0,F.jsx)(M.Z,{onClick:async()=>{if(!a){o(!0);const e="No Environment"===n.id?void 0:n.id,a=(null==c?void 0:c.organizations[0].domain)||y,l=C(i,s,t,r,a,e);navigator.clipboard.writeText(l),setTimeout((()=>{o(!1)}),2e3)}},type:"tertiary",icon:u,text:"Copy Link",isLoading:l||d,"data-testid":"copy-link-button"}):null};var et=i(13101);let tt,it,st=e=>e;const nt=Z().div(tt||(tt=st`
  display: flex;
  height: 56px;
  background-color: var(--background-color-secondary);
  border-bottom-right-radius: var(--border-radius-default);
  border-bottom-left-radius: var(--border-radius-default);
  align-items: center;
  margin-top: 10px;
`)),at=Z().div(it||(it=st`
  float: right;
  margin-left: auto;
  margin-right: var(--spacing-xl);
`)),ot=({entityType:e,entityId:t})=>{const i=(0,et.getTeamId)(),s=(0,et.getUserId)();return(0,F.jsx)(nt,{children:(0,F.jsx)(at,{children:(0,F.jsx)(Je,{entityId:t,entityType:e,userId:s,teamId:i})})})},rt=()=>{const[e,t]=(0,N.useState)(""),[i,s]=(0,N.useState)({checks:{}}),{data:n,isLoading:a,isError:o,refetch:r}=(0,X.useEntityPermissions)(e,i),[l,c]=(0,N.useState)({});return(0,N.useEffect)((()=>{if(!a&&n&&n.results){const e={};for(const t in n.results)e[t]=n.results[t].allowed;c(e)}}),[a,n]),{permissionCheckResults:l,triggerPermissionChecks:(e,i)=>{t(e),s(i)},isError:o,refetch:r}};var lt=i(8323),ct=i(56415),dt=i(36241),ut=i(69917);let pt;const mt=Z().div(pt||(pt=(e=>e)`
  margin-left: auto;
`)),ht=e=>{const{label:t,userId:i,email:s,__isNew__:n,profile_pic_url:a}=e.userData,{isSelected:o,currentRoleDisplayName:r}=e;return(0,F.jsxs)(oe.Z,{alignItems:"center",gap:"spacing-s",width:"100%","data-testid":"invite-user-suggestion-item",children:[n?(0,F.jsx)(ut.Z,{}):(0,F.jsx)(ne.Z,{src:null!=a?a:"",userId:Number(i),size:"s"}),(0,F.jsxs)(oe.Z,{direction:"column",grow:1,shrink:1,minWidth:"0px",children:[(0,F.jsx)(re.ZP,{isTruncated:!0,children:t}),!o&&(0,F.jsx)(re.ZP,{isTruncated:!0,color:"content-color-secondary",children:s})]}),!o&&r&&(0,F.jsx)(mt,{children:(0,F.jsx)(re.ZP,{color:"content-color-secondary",children:r})})]})},vt=e=>{const{isSelected:t,label:i,members:s,currentRoleDisplayName:n}=e;return(0,F.jsxs)(oe.Z,{alignItems:"center",gap:"spacing-s",width:"100%","data-testid":"invite-group-suggestion-item",children:[(0,F.jsx)(de.Z,{}),(0,F.jsxs)(oe.Z,{direction:"column",children:[(0,F.jsx)("span",{children:i}),!t&&(0,F.jsxs)(re.ZP,{color:"content-color-secondary",children:[null==s?void 0:s.length," members"]})]}),!t&&n&&(0,F.jsx)(mt,{children:(0,F.jsx)(re.ZP,{color:"content-color-secondary",children:n})})]})},_t=e=>{const{label:t,desc:i}=e;return(0,F.jsxs)(oe.Z,{direction:"column",gap:"spacing-xs","data-testid":"role-option-item",children:[(0,F.jsx)(re.ZP,{size:"medium",children:t}),(0,F.jsx)(re.ZP,{color:"content-color-secondary",children:i})]})},gt=e=>{var t;return null==(t=e.state)||null==(t=t.isBlocked)?void 0:t.status},yt=e=>{var t;return gt(e)?(0,F.jsx)(le.Z,{content:null==(t=e.state)?void 0:t.isBlocked.detail,children:(0,F.jsx)("div",{children:(0,F.jsx)(_t,(0,s.Z)({},e))})}):(0,F.jsx)(_t,(0,s.Z)({},e))},bt=({optionData:e,userRoleMap:t,roleDropdownOptions:i,userGroupsRoleMap:s})=>{var n;const{selectedInvitees:a}=(0,N.useContext)(Se),{userId:o,groupId:r,isGroup:l,email:c}=e,d=o?null==t?void 0:t[o]:r?null==s?void 0:s[r]:"",u=null==i||null==(n=i.find((e=>e.value===d)))?void 0:n.label,p=a.some((e=>l?e.value===String(r):e.value===c));if(l){const{label:t,members:i}=e;return(0,F.jsx)(vt,{label:t,members:i,isSelected:p,currentRoleDisplayName:u})}return(0,F.jsx)(ht,{userData:e,isSelected:p,currentRoleDisplayName:u})};var kt=i(47503),wt=i(84591),ft=i(16913);let xt,Et,Rt,It=e=>e;const Tt=Z().div(xt||(xt=It`
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: var(--spacing-xs);

  margin: var(--spacing-xs) var(--spacing-xl) var(--spacing-m) var(--spacing-xl);
`)),St={error:"content-color-error",info:"content-color-info",warning:"content-color-warning"},jt=Z()(kt.Z)(Et||(Et=It`
  padding-top: 2px;
`)),Ot=Z()(wt.Z)(Rt||(Rt=It`
  padding-top: 2px;
`)),At=e=>"error"===e?(0,F.jsx)(jt,{color:St[e]}):"warning"===e?(0,F.jsx)(ft.Z,{color:St[e]}):(0,F.jsx)(Ot,{color:St[e]}),Ct=({text:e,type:t})=>(0,F.jsxs)(Tt,{children:[At(t),(0,F.jsx)(re.ZP,{color:St[t],typographyStyle:{fontSize:"text-size-m",fontWeight:"text-weight-regular",lineHeight:"line-height-s",fontFamily:"text-family-default"},"data-testid":"invite-dropdown-error-message",children:e})]});let Lt,Pt,Dt,Nt,Vt,Wt,Zt,Ut,Mt,$t=e=>e;const Kt=Z().div(Lt||(Lt=$t`
  display: flex;
  flex-grow: 1;
  flex-direction: column;
`)),Bt=Z().div(Pt||(Pt=$t`
  display: flex;
  position: relative;
  align-items: center;
  margin: var(--spacing-xl);
  margin-right: var(--spacing-m);
  margin-bottom: ${0}; // To avoid double margin when validation state is visible

  border: ${0};
  border-radius: var(--border-radius-default);
  box-shadow: ${0};

  transition: border 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
  -webkit-transition: border 0.2s ease-in-out, box-shadow 0.2s ease-in-out;

  & > :first-child {
    // Give some space for the roles dropdown and also to make sure that
    // the multi select dropdown doesn't overlap with the roles dropdown
    width: ${0}; // 68px is the width of the roles dropdown
  }

  .aether-dropdown__control {
    width: max-content;
    background: var(--background-color-secondary);

    border-left: 1px solid var(--border-color-strong);
    border: none;
    border-bottom-left-radius: ${0};
    border-top-left-radius: ${0};

    &--is-focused {
      border: none;
      box-shadow: none;

      &:hover {
        border: none;
      }
    }

    &:hover {
      border: none;
      transition: none;
      -webkit-transition: none;
    }
  }

  .aether-multiselect-dropdown__control {
    border: none;
    border-bottom-right-radius: ${0};
    border-top-right-radius: ${0};

    &--is-focused {
      border: none;
      box-shadow: none;

      &:hover {
        border-right: none;
        border: none;
      }
    }

    &:hover {
      border: none;
      transition: none;
      -webkit-transition: none;
    }
  }

  .aether-multiselect-dropdown__menu {
    width: 100%;
  }
`),(({isValidationStateVisible:e})=>e?"0":"var(--spacing-m)"),(({isDropdownSelected:e,validationState:t})=>((e,t)=>"error"===t?"1px solid var(--highlight-background-color-error)":"warning"===t?"1px solid var(--highlight-background-color-warning)":"info"===t?"1px solid var(--highlight-background-color-info)":e?"1px solid var(--blue-30)":"1px solid var(--border-color-strong)")(e,t)),(({isDropdownSelected:e,validationState:t})=>((e,t)=>e?"error"===t?"0 0 0 2px var(--highlight-background-color-error)":"warning"===t?"0 0 0 2px var(--highlight-background-color-warning)":"info"===t?"0 0 0 2px var(--highlight-background-color-info)":"0 0 0 2px var(--blue-30)":"none")(e,t)),(({isRolesDropdownVisible:e})=>e?"calc(100% - 68px)":"100%"),(({isRolesDropdownVisible:e})=>e?"0px":"var(--border-radius-default)"),(({isRolesDropdownVisible:e})=>e?"0px":"var(--border-radius-default)"),(({isRolesDropdownVisible:e})=>e?"0px":"var(--border-radius-default)"),(({isRolesDropdownVisible:e})=>e?"0px":"var(--border-radius-default)")),Gt=Z().div(Dt||(Dt=$t`
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: var(--background-color-secondary);
  border-top-right-radius: var(--border-radius-default);
  border-bottom-right-radius: var(--border-radius-default);
  width: 68px;

  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;

  .tippy-content {
    padding: var(--spacing-s);
  }
`)),Yt=Z().div(Nt||(Nt=$t`
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
`)),Ft=Z().div(Vt||(Vt=$t`
  display: flex;
  align-items: center;
  float: right;
  margin-left: 2px;
  padding-right: 4px;
`)),zt=Z().div(Wt||(Wt=$t`
  display: flex;
  align-items: center;
  height: 28px;
  padding-left: var(--spacing-s);

  :hover {
    cursor: ${0};
    background-color: var(--background-color-tertiary);
    border-radius: var(--border-radius-default);
  }

  opacity: ${0};
`),(({isDisabled:e})=>e?"default":"pointer"),(({isDisabled:e})=>e?"0.5":"1")),Ht=Z().div(Zt||(Zt=$t`
  padding-left: var(--spacing-s);
`)),qt=Z().div(Ut||(Ut=$t`
  width: 16px;
  height: 16px;
  margin-right: var(--spacing-s);
`)),Xt=Z().div(Mt||(Mt=$t`
  background-color: var(--background-color-primary);
  border-radius: var(--border-radius-default);
  padding: var(--spacing-s);
`)),Qt=({label:e="",placeholder:t="",permissions:i,showRoleDropdown:s=!0,className:n="",canManageRolesOnEntity:a,onChange:o})=>{var r;const{selectedInvitees:l,setSelectedInvitees:c,selectedRole:d,setSelectedRole:u,roleOptions:p,isRoleOptionsLoading:m,getInvalidEmailCount:h}=(0,N.useContext)(Se),v=(0,ee.useActiveWorkspaceId)(),[_,g]=(0,N.useState)(!1),[y,b]=(0,N.useState)(!1),[k,w]=(0,N.useState)([]),[f,x]=(0,N.useState)([]),[E,R]=(0,N.useState)({}),[I,T]=(0,N.useState)({}),{data:S,isLoading:j}=(0,ee.useWorkspaceRoles)(v),O=(0,et.getUserId)(),{data:A,isLoading:C}=(0,B.useTeamsByUserId)({userId:O}),L=()=>l.some((e=>e.__isNew__));(0,N.useEffect)((()=>{if(!C&&A&&A.organizations[0]){const e=[],t=[];for(const t of A.organizations[0].team_users)t.id!==O&&e.push({label:t.name||t.username,value:t.email,userId:t.id,email:t.email,profile_pic_url:t.profile_pic_url});w(e);for(const e of A.organizations[0].user_groups)t.push({label:e.name,value:`${e.id}`,groupId:e.id,isGroup:!0,members:e.members});x(t)}}),[C,A,O]),(0,N.useEffect)((()=>{if(!j&&null!=S&&S.listing){const e={},t=S.listing.user||{},i=S.listing.group||{};for(const i in t)e[i]=t[i].roles[0];for(const e in i)I[e]=i[e].roles[0];R(e),T(I)}}),[j,S]);const P=n?V().Fragment:Bt,D=null==(r=h()>0?{validationState:{status:"error",message:h()>1?`${h()} emails are invalid. Enter valid emails to send invite.`:"1 email is invalid. Enter valid email to send invite."}}:i.MANAGE_TEAM_INVITES&&L()?{validationState:{status:"warning",message:"New members will join your team once they accept your invite."}}:i.SEND_UNAPPROVED_INVITES&&!i.MANAGE_TEAM_INVITES&&L()?{validationState:{status:"warning",message:"Your suggestion will be sent to Team Admin for approval."}}:{})?void 0:r.validationState,W=s&&a&&(null==p?void 0:p.length)>0;return(0,F.jsxs)(Kt,{children:[(0,F.jsxs)(P,{isDropdownSelected:y,isRolesDropdownVisible:W,isValidationStateVisible:!!D,validationState:null==D?void 0:D.status,"data-testid":"invite-dropdown-container",children:[(0,F.jsx)(lt.Z,{onOpen:()=>b(!0),onClose:()=>b(!1),onChange:e=>{c(e),o&&o(e)},options:s?[...f,...k]:[...k,...f],isLoading:C,label:e,value:l,allowCreateNewOption:!0,placeholder:t,className:n,customOptionComponent:e=>(0,F.jsx)(bt,{optionData:e,userRoleMap:E,userGroupsRoleMap:I,roleDropdownOptions:p}),onCreateNewOption:e=>{var t;t=e.value,/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)||(e.isInvalid=!0)},closeMenuOnSelect:!0,menuMaxHeight:400,validationState:s?{}:D}),W&&(0,F.jsx)(U.ZP,{trigger:(0,F.jsx)(Gt,{onClick:()=>g((e=>!e)),children:m?(0,F.jsx)(Yt,{children:(0,F.jsx)(q,{})}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(Ht,{children:(0,F.jsx)(re.ZP,{"data-testid":"invite-dropdown-selected-role",children:null==d?void 0:d.label})}),(0,F.jsx)(Ft,{children:(0,F.jsx)(ct.Z,{})})]})}),onClickOutside:()=>g(!1),onOpen:()=>b(!0),onClose:()=>b(!1),isOpen:_,appendTo:"parent",children:(0,F.jsx)(Xt,{"data-testid":"invite-dropdown-role-options-container",children:p.map((e=>{var t,i;const s=(null==(t=e.state)||null==(t=t.isBlocked)?void 0:t.status)||!1,n=s?le.Z:V().Fragment;return(0,F.jsx)(n,{placement:"bottom",content:s?null==(i=e.state)||null==(i=i.isBlocked)?void 0:i.detail:"",children:(0,F.jsxs)(zt,{onClick:()=>(e=>{var t;(null==(t=e.state)||null==(t=t.isBlocked)?void 0:t.status)||(g(!1),u(e))})(e),isDisabled:s,children:[(0,F.jsx)(qt,{children:(null==d?void 0:d.value)===e.value&&(0,F.jsx)(dt.Z,{})}),(0,F.jsx)(re.ZP,{color:"content-color-primary",children:e.label})]})})}))})})]}),s&&D&&(0,F.jsx)(Ct,{text:D.message,type:D.status})]})};var Jt=i(21466);var ei=i(56880);const ti=()=>{const{selectedInvitees:e,selectedRole:t}=(0,N.useContext)(Se),i=(0,et.getUserId)(),{createTeam:a,isTeamCreationInProgress:c}=(()=>{const e=(0,et.getUserId)(),[t,i]=(0,N.useState)(!1);return{createTeam:async()=>{let t;i(!0);try{Jt.VSCodeCommunicationsService.postMessageToExtension({type:"BROADCAST_SIDEBAR",payload:{messageType:"SIDEBAR:LOADING",data:{loadingMessage:"Team creation in progress..."}}}),t=await(async(e,t=[],i=!0,s=!0,a)=>await n.postmanGateway.post({url:`${o().HTTPS_GATEWAY_PRIVATE_URL}/ws/proxy`,path:`/api/users/${e}/start-free-collab`,query:{user_id:e,freecollab:i,auto_join_ws:s,app_version:window.APP_VERSION},service:"god",data:{body:{invitations:t}},signal:a}))(e),i(!1)}catch(e){throw new Error("Error while creating team")}finally{Jt.VSCodeCommunicationsService.postMessageToExtension({type:"BROADCAST_SIDEBAR",payload:{messageType:"SIDEBAR:RESET_LOADING"}})}return t},isTeamCreationInProgress:t}})(),{data:u}=(0,ee.useActiveWorkspaceInfo)(),m=(0,ee.useUpdateWorkspace)(),{addToast:v}=(0,K.ZP)();return{sendInvite:async(n,o,c,_,g,y,b,k,w,f)=>{var x,E;let R=null;const T=e.filter((e=>e.userId)),S=e.filter((e=>e.groupId)),j=e.filter((e=>e.__isNew__));let O=!1,C=b;if(b||(C=(await a()).organization_id,O=!0,ei.AnalyticsService.addEventV2({category:n,action:(c===h.workspace?"invite_ws":"share_element")+":create_team",label:"create_new_team",entityId:o,entityType:n})),(null==u?void 0:u.visibilityStatus)===ee.VISIBILITY_STATUS.personal)if(w===I)R=await(0,ee.createWorkspace)(((e,t,i,n)=>{const a={};var o;if(n)for(const e of t){const t=e.isGroup?"group":"user",n=e.isGroup?e.groupId:e.userId;a[t]=(0,s.Z)({},a[t],n&&{[null==n?void 0:n.toString()]:[null==i?void 0:i.defaultRoles.user]})}else a.team={[e]:[null!=(o=null==i?void 0:i.defaultRoles.team)?o:"defaultRole"]};return{name:n?"New Private Workspace":"New Team Workspace",visibilityStatus:n?ee.VISIBILITY_STATUS.private:ee.VISIBILITY_STATUS.team,roles:a}})(C,[...T,...S],g,f)),await(0,ee.moveElementToWorkspace)(n,o,u.id,R.id),ei.AnalyticsService.addEventV2({category:"workspace",action:"share_element:personal_ws_option",label:I,entityId:o,entityType:n}),v({description:`${n} has been moved to ${R.name}.`,type:"success"});else{const e=f?ee.VISIBILITY_STATUS.private:ee.VISIBILITY_STATUS.team;await(0,ee.updateWorkspaceVisibility)(u.id,e),ei.AnalyticsService.addEventV2({category:"workspace",action:"share_element:personal_ws_option",label:"convert_workspace",entityId:o,entityType:n}),v({description:`Workspace visibility changed to ${e}`,type:"success"})}return(T.length>0||S.length>0)&&await(async(e,t,i,s,n,a,o,r,c)=>{if(!i||!o.value)throw new Error("Workspace info/role value not available");const u={invitees:[],action:p.workspace_add_roles,actionData:{}},m=null==s?void 0:s.defaultRoles.user,{action:v,actionData:_}=A({model:e,modelId:t,canUpdateRoles:r,role:o.value,addWorkspaceContext:e!==h.workspace,workspaceDetails:{id:i.id,role:m},sharePublicContext:!1,activeEnvironment:c});for(const e of n)u.invitees.push({id:e.userId,type:d.user});for(const e of a)u.invitees.push({id:e.groupId,type:d.group});u.action=v,u.actionData=_;const g=await l(u);return ei.AnalyticsService.addEventV2({category:e,action:D(e,v),label:"invite_team_users",entityId:t,entityType:e}),g})(n,o,(0,s.Z)({},u,R),g,T,S,t,y,k),j.length>0&&C&&await(async(e,t,i,s,n,a,o,l,c,d,u,p)=>{if(!o||!s||!d.value)throw new Error("Workspace info/teamId/role value not available");const m={users:c.map((e=>({email:e.value}))),target:{},userId:n,teamId:s};m.target=L(e,t,i,s,n,a,o,null==l?void 0:l.defaultRoles.user,d.value,u,p);const h=await r(m);return ei.AnalyticsService.addEventV2({category:e,action:D(e,m.target.meta.action),label:`external_invites_sent:${d.value}`,value:c.length,entityId:t,entityType:e}),h})(n,o,c,C,i,_,(0,s.Z)({},u,R),g,j,t,y,k),(null==(x=R)?void 0:x.id)&&m((null==(E=R)?void 0:E.id)||null),{isNewTeamCreated:O,teamId:C}},isTeamCreationInProgress:c}},ii=()=>e=>{Jt.VSCodeCommunicationsService.postMessageToExtension({type:"UPDATE_ACCOUNT_DATA",payload:{teamId:Number(e)}})};var si=i(97201);let ni;const ai=Z().div(ni||(ni=(e=>e)`
  & > button {
    height: 34px;

    :disabled {
      background-color: var(--button-primary-background-color) !important;
      color: var(--button-primary-content-color) !important;
      opacity: 0.5;
    }
  }
`)),oi=({entityType:e,entityId:t,entityName:i,canUpdateRoles:s,isDisabled:n,updateWorkspaceVisibilityOption:a,isRestrictTeamWorkspaceEnabled:o})=>{const[r,l]=(0,N.useState)(!1),{selectedInvitees:c,selectedEnvironment:d,setSelectedInvitees:u,getInvalidEmailCount:p}=(0,N.useContext)(Se),{addToast:m}=(0,K.ZP)(),{data:h,isLoading:v}=(0,ee.useWorkspaceRoleConfig)(),{data:_,isLoading:g}=(0,B.useTeamsByUserId)(),{sendInvite:b}=ti(),k=ii(),w=(()=>{const e=(0,et.getUserId)();return()=>{(0,si.invalidateCache)(["team-details",e])}})();return(0,F.jsx)(ai,{children:(0,F.jsx)(M.Z,{type:"primary",text:"Share",isLoading:v||g||r,isDisabled:0===c.length||p()>0||n,onClick:async()=>{ei.AnalyticsService.addEventV2({category:"workspace",action:"share_button_clicked",label:"sharing",entityId:t,entityType:e});try{var n,r;l(!0);const v="No Environment"===(null==d?void 0:d.id)||null==d?void 0:d.id;ei.AnalyticsService.addEventV2({category:`${e}-workbench`,action:`share_${e}`,label:"user_invite",entityType:e,entityId:t,value:1});const{isNewTeamCreated:g,teamId:f}=await b(e,t,i,(null==_||null==(n=_.organizations[0])?void 0:n.domain)||y,h,s,null==_||null==(r=_.organizations[0])?void 0:r.id,v,a,o);g&&f&&(k(f),c=e,p=t,(0,si.invalidateCache)([X.ACCESS_CONTROL_QUERY_KEY_PREFIX,X.DEFAULT_ROLES,c]),(0,si.invalidateCache)([X.ACCESS_CONTROL_QUERY_KEY_PREFIX,X.ALL_ROLES,c,p]),(0,si.invalidateCache)([X.ACCESS_CONTROL_QUERY_KEY_PREFIX,X.ALL_ROLES,c]),w()),m({description:`Successfully shared the ${e}`,status:"success"}),u([]),l(!1)}catch(t){m({description:`Something went wrong while sharing this ${e}`,status:"error"}),l(!1)}var c,p},"data-testid":"share-with-people-button"})})};let ri,li,ci,di=e=>e;const ui=Z().div(ri||(ri=di`
  display: flex;
  margin-right: ${0};
  max-width: 480px;
`),(({shouldHideShareButton:e})=>e&&"var(--spacing-m)")),pi=Z().div(li||(li=di`
  width: ${0};
`),(({shouldHideShareButton:e})=>e?"100%":"calc(100% - 82px)")),mi=Z().div(ci||(ci=di`
  margin-top: var(--spacing-xl);
  margin-right: var(--spacing-xl);
`)),hi=({entityType:e,entityId:t,entityName:i,permissions:s,canManageRolesOnEntity:n,placeholder:a,workspaceVisibility:o,updateWorkspaceVisibilityOption:r,isRestrictTeamWorkspaceEnabled:l,showRoleDropdown:c})=>{const d=!o||o===ee.VISIBILITY_STATUS.personal;return(0,F.jsxs)(ui,{shouldHideShareButton:d,children:[(0,F.jsx)(pi,{shouldHideShareButton:d,children:(0,F.jsx)(Qt,{placeholder:a,permissions:s,canManageRolesOnEntity:n,showRoleDropdown:c})}),!d&&(0,F.jsx)(mi,{children:(0,F.jsx)(oi,{entityType:e,entityId:t,entityName:i,canUpdateRoles:n,updateWorkspaceVisibilityOption:r,isRestrictTeamWorkspaceEnabled:l})})]})};var vi=i(31987),_i=i(38163),gi=i(94250);let yi,bi,ki,wi,fi=e=>e;const xi=Z().div(yi||(yi=fi`
  margin-left: var(--spacing-xl);
`)),Ei=Z().div(bi||(bi=fi`
  margin-bottom: 20px;
`)),Ri=Z().div(ki||(ki=fi`
  margin-bottom: var(--spacing-xl);
`)),Ii=Z().div(wi||(wi=fi`
  margin-bottom: 20px;
  margin-right: var(--spacing-xl);
`)),Ti=({entityType:e,entityId:t,entityName:i,workspaceVisibility:s,selectedOption:n,setSelectedOption:a,canManageRolesOnEntity:o,isRestrictTeamWorkspaceEnabled:r})=>{var l;const{setRoleOptions:c,roleOptions:d,setIsRoleOptionsLoading:u,selectedRole:p,setSelectedRole:m}=(0,N.useContext)(Se),{data:h,isLoading:v}=(0,X.useFetchDefaultRolesForObjectType)(e,!0,!0),{data:_,isLoading:g}=(0,X.useFetchRolesForObject)(e,t,!0,!0),{data:y,isLoading:b}=(0,X.useFetchRolesForObjectType)(e,!0,!0),I=(0,X.useFetchAssociatedRoles)(),{data:T,isLoading:j}=(0,B.useTeamsByUserId)(),O=null==T||null==(l=T.organizations[0])?void 0:l.id;return(0,N.useEffect)((()=>{if(!(d.length>0)&&y&&_&&h){const{rolesList:t,rolesOrder:i,defaultRoles:s}=I(e,_,y,null==h?void 0:h.data),n=S(i.reduce(((e,i)=>{const s=t[i];return s&&e.push(s),e}),[]),["state.isBlocked.status"],["asc"]);c(n.map((e=>({label:e.displayName,value:e.name,state:e.state}))));const a=n.find((e=>e.name===s.user));p.label||m({label:(null==a?void 0:a.displayName)||n[0].displayName,value:(null==a?void 0:a.name)||n[0].name}),u(!1)}}),[b,g,v]),s!==ee.VISIBILITY_STATUS.personal?null:b||g||v||j?(0,F.jsx)(q,{}):(0,F.jsxs)(xi,{children:[(0,F.jsx)(Ei,{"data-testid":"update-workspace-visibility-options-container",children:(0,F.jsxs)(vi.Z,{direction:"column",value:n,onChange:a,label:"Choose how you want to share:","data-testid":"update-workspace-visibility-options-radio-group",children:[(0,F.jsx)(_i.Z,{"data-testid":"move-to-new-workspace-radio",value:f(),label:k(e,r),helperText:w(e,r)}),(0,F.jsx)(_i.Z,{"data-testid":"convert-workspace-radio",value:R(),label:x(e,r),helperText:E(e,r)})]})}),!O&&(0,F.jsx)(Ii,{"data-testid":"create-team-info-banner",children:(0,F.jsx)(gi.Z,{status:"info",children:"Since you don't have a team yet, we'll create one for your members."})}),(0,F.jsx)(Ri,{children:(0,F.jsx)(oi,{entityType:e,entityId:t,entityName:i,canUpdateRoles:o,updateWorkspaceVisibilityOption:n,isDisabled:null===n,isRestrictTeamWorkspaceEnabled:r})})]})};var Si=i(88749);const ji=new class{constructor(){var e=this;this.observer=null,this.workspaceId="",this.abortController=null,this.asyncObserver=null,this.changeWorkspace=e=>{this.workspaceId&&this.unsubscribe(),this.workspaceId=e},this.subscribe=async function({workspaceId:t=e.workspaceId,subscriptionHandler:i}){if(""===t)return;if(e.workspaceId!==t&&e.changeWorkspace(t),e.observer||e.asyncObserver)return;const{asyncObserver:s,abortController:n}=(0,ee.subscribeToWorkspaceEvents)(t);e.abortController=n,e.asyncObserver=s,e.observer=await s,e.abortController=null,e.observer.subscribe({next:e=>{i(e,{workspaceId:t})},complete:()=>{e.unsubscribe()},error:async function(s){e.cleanup(),await e.subscribe({subscriptionHandler:i,workspaceId:t})}})},this.unsubscribe=()=>{var e,t;null==(e=this.abortController)||e.abort(),null==(t=this.observer)||t.unsubscribe(),this.cleanup()},this.cleanup=()=>{this.asyncObserver=null,this.observer=null,this.abortController=null}}};let Oi;const Ai=Z().div(Oi||(Oi=(e=>e)`
  display: flex;
  flex-direction: column;
  width: 480px;
  background-color: var(--background-color-primary);
  border-radius: var(--border-radius-default);
`)),Ci=({entityType:e,entityId:t,entityName:i})=>{var s,n;const{workspaceVisibility:a,isWorkspaceInfoLoading:o}=(0,N.useContext)(Se),[r,l]=(0,N.useState)(null),{permissionCheckResults:c,triggerPermissionChecks:d}=rt(),{planFeatures:u,isLoading:p}=(()=>{var e;const t=(0,et.getUserId)(),{data:i,isLoading:s,isError:n,isRefetching:a,refetch:o}=(0,Si.useGetPlanFeatures)(t);return{planFeatures:null==i||null==(e=i.data)?void 0:e.features,isLoading:s,isError:n,isRefetching:a,refetch:o}})(),{data:m,isLoading:h,isRefetching:v}=(0,B.useTeamsByUserId)(),_=(0,et.getUserId)(),g=null==m||null==(s=m.organizations[0])?void 0:s.id;(()=>{const e=(0,ee.useActiveWorkspaceId)(),t=(()=>{const{setWorkspaceVisibility:e}=(0,N.useContext)(Se),t=(()=>{const e=(0,ee.useActiveWorkspaceId)();return()=>{(0,si.invalidateCache)([ee.WORKSPACE_ROLES_QUERY_KEY,e])}})();return i=>{var s;const n=i.data;if("update_visibility"===(null==(s=i.meta)?void 0:s.action))for(const i of n)if(i.path.includes("/visibilityStatus")){const s=i.value;e(s),t()}}})();(0,N.useEffect)((()=>{if(e)return ji.subscribe({workspaceId:e,subscriptionHandler:t}),()=>{ji.unsubscribe()}}),[e])})();const y=c[P(e,"update")],b=null==u||null==(n=u.restrict_team_workspace_creation)?void 0:n.value;return(0,N.useEffect)((()=>{h||v||d(g||"0",{checks:{[P(e,"update")]:{entityType:"user",entityId:_,permission:P(e,"update"),objectType:e,objectId:t},MANAGE_TEAM_INVITES:{entityType:"user",entityId:_,permission:"MANAGE_TEAM_INVITES",objectType:"team",objectId:g||"0"},SEND_UNAPPROVED_INVITES:{entityType:"user",entityId:_,permission:"SEND_UNAPPROVED_INVITES",objectType:"team",objectId:g||"0"}}})}),[g,h,v]),(0,F.jsx)(K.VW,{children:(0,F.jsx)(Ai,{"data-testid":"share-popover-contents-container",children:a===ee.VISIBILITY_STATUS.personal?(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(hi,{placeholder:"Add name, group name or email...",entityType:e,entityId:t,entityName:i,permissions:c,canManageRolesOnEntity:y,workspaceVisibility:a,updateWorkspaceVisibilityOption:r,isRestrictTeamWorkspaceEnabled:b,showRoleDropdown:!!g}),(0,F.jsx)(Be,{entityType:e}),(0,F.jsx)(qe,{height:"24px"}),(0,F.jsx)(Ti,{entityType:e,entityId:t,entityName:i,canManageRolesOnEntity:y,updateWorkspaceVisibilityOption:r,workspaceVisibility:a,selectedOption:r,setSelectedOption:l,isRestrictTeamWorkspaceEnabled:b})]}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(hi,{placeholder:"Add name, group name or email...",entityType:e,entityId:t,entityName:i,permissions:c,canManageRolesOnEntity:y,workspaceVisibility:a,updateWorkspaceVisibilityOption:r,isRestrictTeamWorkspaceEnabled:b}),(0,F.jsx)(Le,{entityType:e,entityId:t,canManageRolesOnEntity:y,workspaceVisibility:a,isWorkspaceInfoLoading:o}),(0,F.jsx)(qe,{height:"24px"}),(0,F.jsx)(Be,{entityType:e}),(0,F.jsx)(ot,{entityType:e,entityId:t})]})})})};let Li;const Pi=Z()(U.ZP)(Li||(Li=(e=>e)`
  .tippy-content {
    padding: var(--spacing-zero);
  }

  .aether-dropdown__dropdown-indicator {
    padding: var(--spacing-zero) !important;
  }
`)),Di=({entityType:e,entityId:t,entityName:i})=>(0,F.jsx)(je,{children:(0,F.jsx)(Pi,{trigger:(0,F.jsx)(M.Z,{"data-testid":"collaboration-share-button",type:"tertiary",text:"Share",icon:(0,F.jsx)($.Z,{})}),onOpen:()=>{ei.AnalyticsService.addEventV2({category:"workspace",action:"share_element:initiate",label:"sharing",entityId:t,entityType:e})},onClose:()=>{ei.AnalyticsService.addEventV2({category:"workspace",action:"share_popover_closed",label:"sharing",entityId:t,entityType:e})},appendTo:"parent",maxWidth:"550px",children:(0,F.jsx)(Ci,{entityType:e,entityId:t,entityName:i})})});var Ni=i(49437),Vi=i(22135);const Wi=({loadingMessage:e=""})=>(0,F.jsx)(Y.Z,{size:"large",description:e}),Zi=({entityType:e,entityId:t,entityName:i,teamId:s,userId:n,workspaceInfo:a,permissions:o,selectedRole:r,userTeamDomain:l,workspaceDefaultRole:d})=>{const{selectedEnvironment:u}=(0,N.useContext)(Se),[p,m]=(0,N.useState)(!1),[h,v]=(0,N.useState)(!1),{addToast:_}=(0,K.ZP)(),g=p?(0,F.jsx)(Xe.Z,{}):(0,F.jsx)(Qe.Z,{});return s&&a?(0,F.jsx)(M.Z,{onClick:async()=>{if(o.MANAGE_TEAM_INVITES||o.SEND_UNAPPROVED_INVITES){if(!p){v(!0);try{const p=L(e,t,i,s,n,l,a,d,r.value,o.UPDATE_WORKSPACE_ROLES,u.id),h=(await c(p)).multiuse_invitations[0].link;navigator.clipboard.writeText(h),m(!0),setTimeout((()=>{m(!1)}),2e3)}catch(e){_({status:"error",description:"Something went wrong while generating the invite link."})}finally{v(!1)}}}else _({status:"error",description:"You do not have admin permission to perform this action"})},type:"tertiary","data-testid":"copy-link-btn",icon:g,text:p?"Copied":"Copy Invite Link",isLoading:h}):null};let Ui;const Mi=Z()(M.Z)(Ui||(Ui=(e=>e)`
  :disabled {
    background-color: var(--button-primary-background-color) !important;
    color: var(--button-primary-content-color) !important;
    opacity: 0.5;
  }
`)),$i=e=>{var t;const i=(0,ee.useActiveWorkspaceId)(),[s,n]=(0,N.useState)(),{data:a,isLoading:o,isError:r,refetch:l}=(0,ee.useActiveWorkspaceInfo)(),c=(0,et.getUserId)(),{selectedInvitees:d,selectedRole:u,setSelectedRole:p,roleOptions:m,setRoleOptions:v,setIsRoleOptionsLoading:_,getInvalidEmailCount:g}=(0,N.useContext)(Se),{data:b,isLoading:k,isRefetching:w,refetch:f}=(0,B.useTeamsByUserId)(),{data:x,isLoading:E,refetch:R}=(0,ee.useWorkspaceRoleConfig)(),{permissionCheckResults:I,triggerPermissionChecks:T,isError:S}=rt(),{sendInvite:j,isTeamCreationInProgress:O}=ti(),[A,C]=(0,N.useState)(!0),[L,P]=(0,N.useState)(!1),D=ii(),V=()=>{P(!1),C(!0),l(),R(),f()};return(0,N.useEffect)((()=>{ei.AnalyticsService.addEventV2({category:"workspace",action:"invite_ws:initiate",label:"invite_to_ws_open",entityId:i,entityType:"workspace"}),V(),(0,si.invalidateCache)([ee.WORKSPACE_ROLES_QUERY_KEY,i])}),[]),(0,N.useEffect)((()=>{_(E)}),[E,_]),(0,N.useEffect)((()=>{var e;!k&&null!=b&&null!=(e=b.organizations[0])&&e.id&&n(b.organizations[0].id)}),[k,b]),(0,N.useEffect)((()=>{k||w||(c&&s?T(i+s,{checks:{MANAGE_TEAM_INVITES:{entityType:"user",entityId:c,permission:"MANAGE_TEAM_INVITES",objectType:"team",objectId:s},SEND_UNAPPROVED_INVITES:{entityType:"user",entityId:c,permission:"SEND_UNAPPROVED_INVITES",objectType:"team",objectId:s},UPDATE_WORKSPACE_ROLES:{entityType:"user",entityId:c,permission:"UPDATE_WORKSPACE_ROLES",objectType:"workspace",objectId:i}}}):T(i+c,{checks:{UPDATE_WORKSPACE_ROLES:{entityType:"user",entityId:c,permission:"UPDATE_WORKSPACE_ROLES",objectType:"workspace",objectId:i}}}))}),[s,c,i,k,w]),(0,N.useEffect)((()=>{if(!E&&x){const t=x.teamRoles.default[0]||[],i=[];for(const s of t){var e;null!=(e=s.state)&&null!=(e=e.isInvalid)&&e.status||i.push({label:s.displayName,value:s.name,desc:s.description,state:s.state})}v(i);const s=i.find((e=>e.value===x.defaultRoles.user));s&&p(s)}}),[E,x]),(0,N.useEffect)((()=>{Object.keys(I).length>0&&!o&&!k&&C(!1)}),[I,o,k]),(0,N.useEffect)((()=>{(S||r)&&P(!0)}),[S,r]),L?(0,F.jsx)(oe.Z,{padding:"spacing-l",children:(0,F.jsx)(Ni.Z,{title:"Couldn’t load Invite form",description:"Just a faulty wire. Try reloading.",primaryAction:(0,F.jsx)(M.Z,{type:"outline",text:"Reload",onClick:V}),children:(0,F.jsx)(Vi.Z,{})})}):A?(0,F.jsx)(Wi,{loadingMessage:O?"Team creation in progress...":""}):(0,F.jsx)(oe.Z,{className:"workspace-role-selection",direction:"row",justifyContent:"space-between",alignItems:"center",width:"100%",children:(0,F.jsxs)(oe.Z,{direction:"column",width:"100%",gap:"spacing-m",children:[(null==a?void 0:a.visibilityStatus)===ee.VISIBILITY_STATUS.personal&&(0,F.jsx)(gi.Z,{status:"info",children:"Inviting people will change this into a team workspace."}),(0,F.jsx)(Qt,{label:"Name, email, or group name",permissions:I,showRoleDropdown:!1,className:"invite-to-ws-input-dropdown",canManageRolesOnEntity:I.UPDATE_WORKSPACE_ROLES,onChange:e.onChange}),I.UPDATE_WORKSPACE_ROLES&&s&&(0,F.jsx)(se.Z,{className:"invite-to-ws-role-dropdown",onChange:e=>{p(e)},options:m,value:u,isLoading:E,isOptionDisabled:gt,label:"Role",customOptionComponent:yt,isSearchable:!1,isClearable:!1}),(0,F.jsxs)(oe.Z,{justifyContent:"space-between",children:[s&&(0,F.jsx)(Zi,{entityType:h.workspace,entityId:i,entityName:null==a?void 0:a.name,teamId:s,userId:c,workspaceInfo:a,workspaceDefaultRole:null==x?void 0:x.defaultRoles.user,permissions:I,selectedRole:u,userTeamDomain:(null==b||null==(t=b.organizations[0])?void 0:t.domain)||y}),(0,F.jsx)(Mi,{type:"primary",text:"Send Invite","data-testid":"invite-btn",onClick:async()=>{C(!0);try{var t;const{isNewTeamCreated:n,teamId:o}=await j(h.workspace,i,null==a?void 0:a.name,(null==b||null==(t=b.organizations[0])?void 0:t.domain)||y,x,I.UPDATE_WORKSPACE_ROLES,s);null==e.onSuccess||e.onSuccess(),n&&o&&D(o)}catch(t){null==e.onError||e.onError()}finally{C(!1)}},isLoading:k||E,isDisabled:0===d.length||g()>0})]})]})})},Ki=({onInviteSuccess:e,onInviteError:t,onChange:i})=>(0,F.jsx)(je,{children:(0,F.jsx)($i,{onSuccess:e,onError:t,onChange:i})})}}]);
//# sourceMappingURL=9519.3195490d739f0a79.js.map